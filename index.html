<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"kanwuqing.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æ‰‹æŒ‘å°å‰‘èµ›å°ä»™, çŠ¹æŠ±è½»è½¯æ•´æ—¥é—²">
<meta property="og:type" content="website">
<meta property="og:title" content="Kanwuqing&#39;s Homepage">
<meta property="og:url" content="https://kanwuqing.github.io/index.html">
<meta property="og:site_name" content="Kanwuqing&#39;s Homepage">
<meta property="og:description" content="æ‰‹æŒ‘å°å‰‘èµ›å°ä»™, çŠ¹æŠ±è½»è½¯æ•´æ—¥é—²">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Kanwuqing">
<meta property="article:tag" content="Python,Coding">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://kanwuqing.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Kanwuqing's Homepage</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Kanwuqing's Homepage</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">To Be Legend</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kanwuqing"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Kanwuqing</p>
  <div class="site-description" itemprop="description">æ‰‹æŒ‘å°å‰‘èµ›å°ä»™, çŠ¹æŠ±è½»è½¯æ•´æ—¥é—²</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kanwuqing" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kanwuqing" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kanwuqing@163.com" title="E-Mail â†’ mailto:kanwuqing@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kanwuqing.github.io/Week2%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Kanwuqing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanwuqing's Homepage">
      <meta itemprop="description" content="æ‰‹æŒ‘å°å‰‘èµ›å°ä»™, çŠ¹æŠ±è½»è½¯æ•´æ—¥é—²">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Kanwuqing's Homepage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Week2%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">LegendWechatBot é¡¹ç›®è¿›ç¨‹ Week2(2025-03-10 ~ 2025-03-16)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-15 10:00:00 / ä¿®æ”¹æ—¶é—´ï¼š21:42:17" itemprop="dateCreated datePublished" datetime="2025-03-15T10:00:00+08:00">2025-03-15</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span></span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>NaN:aN</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>åœ¨ä¸‹æ–‡ä¸­, LWBä»£è¡¨ LegendWechatBot, LBWåŒç†</p>
</blockquote>
<h2 id="å‘½ä»¤å¤„ç†è§„èŒƒ"><a href="#å‘½ä»¤å¤„ç†è§„èŒƒ" class="headerlink" title="å‘½ä»¤å¤„ç†è§„èŒƒ"></a>å‘½ä»¤å¤„ç†è§„èŒƒ</h2><p>åœ¨LBWçš„å‰èº«ä½œå“ä¸­, æˆ‘æ›¾ç»å°è¯•è¿‡ä½¿ç”¨NLPæŠ€æœ¯æ¥å¤„ç†ç”¨æˆ·çš„æŒ‡ä»¤, æ•ˆæœå´ä¸å°½äººæ„. åŸå› æ˜¯NLPåœ¨å¤„ç†ä¸­æ–‡æŒ‡ä»¤æ—¶, æ•ˆæœå¹¶ä¸ç†æƒ³, åŒæ—¶è¿˜ä¼šé‡åˆ°å„ç§æ„æƒ³ä¸åˆ°çš„è¯­æ³•æˆ–è€…é€»è¾‘é—®é¢˜. å› æ­¤, åœ¨LBWä¸­, æˆ‘å†³å®šé‡‡ç”¨ä¸€ç§æ›´ä¸ºç®€å•ç›´æ¥çš„æ–¹æ³•æ¥å¤„ç†ç”¨æˆ·çš„æŒ‡ä»¤, å³ä½¿ç”¨å‘½ä»¤å¤„ç†è§„èŒƒ.</p>
<h3 id="æŒ‡ä»¤æ ¼å¼"><a href="#æŒ‡ä»¤æ ¼å¼" class="headerlink" title="æŒ‡ä»¤æ ¼å¼"></a>æŒ‡ä»¤æ ¼å¼</h3><p>åœ¨LBWæ’ä»¶ä¸­, æœ‰ä¸¤ç§æŒ‡ä»¤æ ¼å¼, åˆ†åˆ«æ˜¯ç®€ç•¥ç‰ˆå’Œè¯¦ç»†ç‰ˆ. å…¶ä¸­ç®€ç•¥ç‰ˆæ˜¯æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦å…·å¤‡çš„, è€Œè¯¦ç»†ç‰ˆåˆ™æ˜¯ä¾›è¦æ±‚å‚æ•°è¾ƒå¤æ‚, å¯¹äºè¿”å›ç»“æœè¦æ±‚æ›´é«˜, æ›´ç²¾ç»†åŒ–çš„ç”¨æˆ·ä½¿ç”¨</p>
<h4 id="ç®€ç•¥ç‰ˆ"><a href="#ç®€ç•¥ç‰ˆ" class="headerlink" title="ç®€ç•¥ç‰ˆ"></a>ç®€ç•¥ç‰ˆ</h4><blockquote>
<p>è¯¥æ ¼å¼å—åˆ°Pythonå‡½æ•°è°ƒç”¨æ ¼å¼å¯å‘</p>
</blockquote>
<p>ç®€ç•¥ç‰ˆæŒ‡ä»¤æ ¼å¼å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ’ä»¶åˆ«å æŒ‡ä»¤å‚æ•°1 æŒ‡ä»¤å‚æ•°2 ... æŒ‡ä»¤å‚æ•°n</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æ’ä»¶åˆ«åæ˜¯å†™åœ¨main.pyçš„__init__å®šä¹‰çš„cmdå˜é‡ä¸­çš„, æ¯ä¸ªæ’ä»¶åˆ«åæ•°é‡éœ€&lt;&#x3D;1</p>
<blockquote>
<p>è°ƒç”¨ç®€ç•¥ç‰ˆæŒ‡ä»¤éœ€è¦ç§èŠæˆ–@</p>
</blockquote>
<p>ä¾‹å¦‚:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@botâ€…å¤©æ°” æŸ¥è¯¢ ä¸Šæµ· ä»Šå¤©</span><br></pre></td></tr></table></figure>

<h4 id="è¯¦ç»†ç‰ˆ"><a href="#è¯¦ç»†ç‰ˆ" class="headerlink" title="è¯¦ç»†ç‰ˆ"></a>è¯¦ç»†ç‰ˆ</h4><blockquote>
<p>è¯¦ç»†ç‰ˆæŒ‡ä»¤å—å‘½ä»¤è¡Œå‘½ä»¤æ ¼å¼å¯å‘</p>
</blockquote>
<p>è¯¦ç»†ç‰ˆæŒ‡ä»¤æ ¼å¼å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/æŒ‡ä»¤ -å‚æ•°1 å‚æ•°å€¼1 ... -å‚æ•°n å‚æ•°å€¼n</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/weather -m pre -c ä¸Šæµ· --date 2025-03-10</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­å„ä¸ªå‚æ•°çš„ä½ç½®å¯ä»¥é¢ å€’</p>
</blockquote>
<h3 id="æŒ‡ä»¤å¤„ç†"><a href="#æŒ‡ä»¤å¤„ç†" class="headerlink" title="æŒ‡ä»¤å¤„ç†"></a>æŒ‡ä»¤å¤„ç†</h3><p>ç®€ç•¥ç‰ˆæŒ‡ä»¤å¾ˆå¥½å¤„ç†, ä¸æ–­åœ°startswithç„¶åsplitå³å¯</p>
<p>è¯¦ç»†ç‰ˆæŒ‡ä»¤ç”±äºä¸çŸ¥é“æ¯ä¸ªæ’ä»¶æ‰€éœ€çš„å‚æ•°, å› æ­¤éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥é¢„è§£ææŒ‡ä»¤, ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_command</span>(<span class="params">command</span>):</span><br><span class="line">    <span class="comment"># å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</span></span><br><span class="line">    pattern = <span class="string">r&#x27;/(?P&lt;command&gt;\w+)(?:\s+-\w+\s+(?:&quot;[^&quot;]*&quot;|\S+))*&#x27;</span></span><br><span class="line">    matches = re.finditer(pattern, command)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–ç»“æœå­—å…¸</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        <span class="comment"># æå–å‘½ä»¤</span></span><br><span class="line">        cmd = <span class="keyword">match</span>.group(<span class="string">&#x27;command&#x27;</span>)</span><br><span class="line">        result[<span class="string">&#x27;command&#x27;</span>] = cmd</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æå–å‚æ•°</span></span><br><span class="line">        params_pattern = <span class="string">r&#x27;-(?P&lt;key&gt;\w+)\s+(?P&lt;value&gt;&quot;[^&quot;]*&quot;|\S+)&#x27;</span></span><br><span class="line">        params_matches = re.finditer(params_pattern, command)</span><br><span class="line">        </span><br><span class="line">        params = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> param_match <span class="keyword">in</span> params_matches:</span><br><span class="line">            key = param_match.group(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">            value = param_match.group(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">            <span class="comment"># å»æ‰å¼•å·</span></span><br><span class="line">            <span class="keyword">if</span> value.startswith(<span class="string">&#x27;&quot;&#x27;</span>) <span class="keyword">and</span> value.endswith(<span class="string">&#x27;&quot;&#x27;</span>):</span><br><span class="line">                value = value[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">            params[key] = value</span><br><span class="line">        </span><br><span class="line">        result[<span class="string">&#x27;params&#x27;</span>] = params</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>


<h2 id="é¡¹ç›®æ–°å¢ç»“æ„"><a href="#é¡¹ç›®æ–°å¢ç»“æ„" class="headerlink" title="é¡¹ç›®æ–°å¢ç»“æ„"></a>é¡¹ç›®æ–°å¢ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">LegendWechatBot</span><br><span class="line">â”œâ”€ database  # æœºå™¨äººæ•°æ®å­˜å‚¨</span><br><span class="line">â”‚  â”œâ”€ keyval.db</span><br><span class="line">â”‚  â”œâ”€ keyvalDB.py</span><br><span class="line">â”‚  â”œâ”€ Legendbot.db</span><br><span class="line">â”‚  â”œâ”€ LegendBotDB.py  # ç”¨æ¥å­˜å‚¨å¥½å‹ä»¥åŠç¾¤èŠä¿¡æ¯</span><br><span class="line">â”‚  â”œâ”€ message.db</span><br><span class="line">â”‚  â”œâ”€ messsagDB.py  # å•ç‹¬å­˜å‚¨æ¶ˆæ¯</span><br><span class="line">â”‚  â””â”€ __init__.py</span><br><span class="line">â”œâ”€ docs</span><br><span class="line">â”‚  â””â”€ ban.txt  # è¿ç¦è¯è¯åº“</span><br><span class="line">â”œâ”€ LICENSE</span><br><span class="line">â”œâ”€ logs  # å­˜å‚¨è¿è¡Œæ—¥å¿—</span><br><span class="line">â”œâ”€ plugins  # æ’ä»¶æ–‡ä»¶å¤¹</span><br><span class="line">â”‚  â”œâ”€ AcceptFriend  # è‡ªåŠ¨é€šè¿‡å¥½å‹</span><br><span class="line">â”‚  â”‚  â”œâ”€ config.yaml  # æ’ä»¶é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚  â”‚  â”œâ”€ main.py  # æ’ä»¶å…¥å£</span><br><span class="line">â”‚  â”‚  â””â”€ __init__.py  # ä½¿æ–‡ä»¶å¤¹å¯è¢«è¯†åˆ«</span><br><span class="line">â”‚  â”œâ”€ GroupWelcome  # å…¥ç¾¤æ¬¢è¿</span><br><span class="line">â”‚  â”‚  â”œâ”€ config.yaml</span><br><span class="line">â”‚  â”‚  â”œâ”€ main.py</span><br><span class="line">â”‚  â”‚  â””â”€ __init__.py</span><br><span class="line">â”‚  â”œ  TCM  # ä¸­è¯è¯æ–¹æŸ¥è¯¢</span><br><span class="line">â”‚  â”‚  â”œâ”€ config.yaml  # é…ç½®æ–‡ä»¶, åŒæ—¶åŒ…æ‹¬ä¸­è¯è¯æ–¹çš„å†³ç­–æ ‘</span><br><span class="line">â”‚  â”‚  â”œâ”€ main.py</span><br><span class="line">â”‚  â”‚  â””â”€ __init__.py</span><br><span class="line">â”‚  â””â”€ VVQuest  # å¼ ç»´ä¸ºè¡¨æƒ…åŒ…æŸ¥è¯¢ (ä¸‹å‘¨æ›´æ–°)</span><br><span class="line">â”‚     â”œâ”€ config.yaml  # æ’ä»¶é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚     â”œâ”€ config</span><br><span class="line">â”‚     â”‚  â”œâ”€ config.yaml  # é¡¹ç›®é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚     â”‚  â”œâ”€ settings.py</span><br><span class="line">â”‚     â”‚  â””â”€ __init__.py</span><br><span class="line">â”‚     â”œâ”€ data</span><br><span class="line">â”‚     â”‚  â”œâ”€ embeddings.pkl  # apiæ¨¡å‹æ–‡ä»¶</span><br><span class="line">â”‚     â”‚  â”œâ”€ embeddings_bge-large-zh-v1.5.pkl  # æœ¬åœ°æ¨¡å‹æ–‡ä»¶</span><br><span class="line">â”‚     â”‚  â”œâ”€ images  # å›¾ç‰‡æ–‡ä»¶å¤¹</span><br><span class="line">â”‚     â”‚  â”œâ”€ image_dirs</span><br><span class="line">â”‚     â”‚  â””â”€ models</span><br><span class="line">â”‚     â”‚     â””â”€ bge-large-zh-v1.5  # è°ƒç”¨çš„é¢„è®­ç»ƒæ¨¡å‹</span><br><span class="line">â”‚     â”œâ”€ LICENSE</span><br><span class="line">â”‚     â”œâ”€ README.md</span><br><span class="line">â”‚     â”œâ”€ services</span><br><span class="line">â”‚     â”‚  â”œâ”€ embedding_service.py  # æ¨¡å‹æœåŠ¡</span><br><span class="line">â”‚     â”‚  â”œâ”€ image_search.py  # å›¾ç‰‡æœç´¢æœåŠ¡</span><br><span class="line">â”‚     â”‚  â””â”€ utils.py  # å…¶ä»–æ–¹æ³•</span><br><span class="line">â”‚     â””â”€ main.py</span><br><span class="line">â””â”€ main.py  # ä¸»å¯åŠ¨ç¨‹åº</span><br></pre></td></tr></table></figure>

<h2 id="æ’ä»¶è§„èŒƒ"><a href="#æ’ä»¶è§„èŒƒ" class="headerlink" title="æ’ä»¶è§„èŒƒ"></a>æ’ä»¶è§„èŒƒ</h2><p>åœ¨LBWä¸­, æˆ‘å»ºè®®æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦éµå¾ªä¸€å®šçš„è§„èŒƒ, ä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œç»´æŠ¤. LBWçš„æ’ä»¶è§„èŒƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢:</p>
<h3 id="æ’ä»¶ç›®å½•ç»“æ„"><a href="#æ’ä»¶ç›®å½•ç»“æ„" class="headerlink" title="æ’ä»¶ç›®å½•ç»“æ„"></a>æ’ä»¶ç›®å½•ç»“æ„</h3><p>æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç›®å½•, ç›®å½•åå³ä¸ºæ’ä»¶å. æ’ä»¶ç›®å½•ä¸‹éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:</p>
<ul>
<li><code>config.yaml</code>: æ’ä»¶é…ç½®æ–‡ä»¶, ç”¨äºå­˜å‚¨æ’ä»¶çš„é…ç½®ä¿¡æ¯.</li>
<li><code>__init__.py</code>: å ä½</li>
<li><code>main.py</code>: æ’ä»¶çš„ä¸»ç¨‹åºæ–‡ä»¶, åŒ…å«æ’ä»¶çš„å…¥å£å‡½æ•°å’ŒæŒ‡ä»¤å¤„ç†å‡½æ•°.</li>
</ul>
<h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>é…ç½®æ–‡ä»¶ç”¨äºå­˜å‚¨æ’ä»¶çš„é…ç½®ä¿¡æ¯, æœ€å¤–å±‚ä¸ºæ’ä»¶å, å…¶ä¸­æ¯”éœ€åŒ…å« <em>enable</em> å­—æ®µç”¨æ¥ç®¡ç†è¯¥æ’ä»¶æ˜¯å¦å¯ç”¨; åŒ…å« <em>description</em> ä»¥åŠ <em>author</em> ç”¨æ¥æ˜¾ç¤ºæ’ä»¶ç®€ä»‹å’Œä½œè€…; åŒ…å« <em>cmd</em> ç”¨æ¥è§„å®šç®€ç•¥æŒ‡ä»¤. ä»¥ä¸‹æ˜¯ä¸ºç¤ºä¾‹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TCM:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">ä¸­è¯è¯æ–¹æŸ¥è¯¢</span></span><br><span class="line">  <span class="attr">author:</span> <span class="string">Kanwuqing</span></span><br><span class="line">  <span class="attr">cmd:</span> <span class="string">ä¸­è¯</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">otherSettings:</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸»ç¨‹åºæ–‡ä»¶"><a href="#ä¸»ç¨‹åºæ–‡ä»¶" class="headerlink" title="ä¸»ç¨‹åºæ–‡ä»¶"></a>ä¸»ç¨‹åºæ–‡ä»¶</h4><p>ä¸»ç¨‹åºæ–‡ä»¶æ˜¯æ’ä»¶çš„å…¥å£å‡½æ•°å’ŒæŒ‡ä»¤å¤„ç†å‡½æ•°, éœ€è¦åŒ…å«å’Œæ’ä»¶ååŒåçš„ç±», è¯¥ç±»éœ€ç»§æ‰¿è‡ª <a href="utils%5Cplugin.py">plugin.py</a> ä¸­çš„ <em>PluginBase</em> æ’ä»¶åŸºç±», å¤„ç†æ¶ˆæ¯çš„å‡½æ•°éœ€ä½¿ç”¨ <em>on_message</em> è£…é¥°å™¨å¹¶ä½¿ç”¨asyncå…³é”®å­—è¿›è¡Œå¼‚æ­¥å¤„ç†, åŒæ—¶éœ€è¦å¯¹ç®€ç•¥æŒ‡ä»¤è¿›è¡ŒSJ(ç‰¹åˆ¤), ä»¥è¾“å‡ºæ’ä»¶çš„è¯¦ç»†æŒ‡ä»¤ç”¨æ³•, ä»¥ä¸‹ä¸ºç¤ºä¾‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plugins/Demo/main.py</span></span><br><span class="line"><span class="keyword">from</span> utils.decorators <span class="keyword">import</span> on_system_message</span><br><span class="line"><span class="keyword">from</span> utils.plugin <span class="keyword">import</span> PluginBase</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>(<span class="title class_ inherited__">PluginBase</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–è®¾ç½®</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;plugins/Demo/config.yaml&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            plugin_config = yaml.safe_load(f)</span><br><span class="line"></span><br><span class="line">        config = plugin_config[<span class="string">&quot;Demo&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.enable = config[<span class="string">&quot;enable&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.cmd = config[<span class="string">&quot;cmd&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @on_system_message</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">demo</span>(<span class="params">self, bot: LegendWechatBot, message: WxMsg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.enable:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> message.content == <span class="variable language_">self</span>.cmd:</span><br><span class="line">            bot.sendMsg(<span class="string">&#x27;Demoä½¿ç”¨æ–¹æ³•&#x27;</span>, message.sender)</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<h2 id="æ–°å¢åŠŸèƒ½"><a href="#æ–°å¢åŠŸèƒ½" class="headerlink" title="æ–°å¢åŠŸèƒ½"></a>æ–°å¢åŠŸèƒ½</h2><h3 id="æ•°æ®åº“ç®¡ç†"><a href="#æ•°æ®åº“ç®¡ç†" class="headerlink" title="æ•°æ®åº“ç®¡ç†"></a>æ•°æ®åº“ç®¡ç†</h3><blockquote>
<p>æœ‰æ•°æ®æ‰æœ‰æœåŠ¡</p>
</blockquote>
<p>åœ¨LegendWechatBotä¸­, æ ¸å¿ƒç»´æŠ¤å¢æ·»çš„æ•°æ®åº“å…±æœ‰ä¸¤ä¸ª: <em>LegendBotDB</em> ä¸ <em>messageDB</em>.</p>
<h4 id="LegendBotDB"><a href="#LegendBotDB" class="headerlink" title="LegendBotDB"></a><a href="./database/LegendBotDB.py">LegendBotDB</a></h4><p>LegendBotDBæ˜¯ç”¨äºå­˜å‚¨ä¸ªæ€§åŒ–ç”¨æˆ·å’Œç¾¤èŠä¿¡æ¯çš„æ•°æ®åº“ (æ’ä»¶ç›¸å…³çš„ä¸å­˜, ç•™ç»™æ’ä»¶è‡ªå·±å­˜)</p>
<blockquote>
<p>LegendBotDBä¸ä¼šåœ¨æ¯æ¬¡å¯åŠ¨æ—¶æ¸…ç©º, ä½†æä¾›äº†æ¸…ç©ºçš„æ–¹æ³• <em>recreate</em> (ç”¨äºæ›´æ–°å­—æ®µæ—¶)</p>
</blockquote>
<p><em>Users</em> è¡¨ä¸»è¦éœ€è¦ç»´æŠ¤çš„å­—æ®µæœ‰:</p>
<ul>
<li><code>id</code>: ç”¨æˆ·æˆ–ç¾¤èŠçš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li><code>points</code>: ç”¨æˆ·ç§¯åˆ†</li>
<li><code>running</code>: ç”¨æˆ·æˆ–æ˜¯å¦åœ¨è¿è¡Œå¤§ä»»åŠ¡</li>
<li><code>black</code>: ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•</li>
</ul>
<p><em>Groups</em> è¡¨ä¸»è¦éœ€è¦ç»´æŠ¤çš„å­—æ®µæœ‰:</p>
<ul>
<li><code>whitelist</code>: éœ€è¦å¤„ç†æ¶ˆæ¯çš„ç¾¤èŠç™½åå•</li>
</ul>
<h4 id="messageDB"><a href="#messageDB" class="headerlink" title="messageDB"></a><a href="./database/messageDB.py">messageDB</a></h4><p>messageDBæ˜¯ç”¨äºå­˜å‚¨éœ€è¦å¤„ç†æ¶ˆæ¯çš„æ•°æ®åº“, ä¸»è¦ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„å‘é€è€…, æ¥æ”¶è€…, æ¶ˆæ¯å†…å®¹, æ¶ˆæ¯æ—¶é—´, æ¶ˆæ¯ç±»å‹, æ¶ˆæ¯çŠ¶æ€ç­‰ä¿¡æ¯, ä¾¿äºå›æº¯</p>
<blockquote>
<p>messageDBä¼šåœ¨æ¯æ¬¡å¯åŠ¨æ—¶æ¸…ç©º</p>
</blockquote>
<p><em>Messages</em> è¡¨ä¸»è¦éœ€è¦ç»´æŠ¤çš„å­—æ®µæœ‰:</p>
<ul>
<li><code>id</code>: æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li><code>from_id</code>: æ¶ˆæ¯çš„å‘é€è€…</li>
<li><code>to_id</code>: æ¶ˆæ¯çš„æ¥æ”¶è€…</li>
<li><code>content</code>: æ¶ˆæ¯çš„å†…å®¹</li>
<li><code>timestamp</code>: æ¶ˆæ¯çš„æ—¶é—´</li>
<li><code>type</code>: æ¶ˆæ¯çš„ç±»å‹</li>
</ul>
<h3 id="è‡ªåŠ¨æ·»åŠ å¥½å‹"><a href="#è‡ªåŠ¨æ·»åŠ å¥½å‹" class="headerlink" title="è‡ªåŠ¨æ·»åŠ å¥½å‹"></a>è‡ªåŠ¨æ·»åŠ å¥½å‹</h3><p>é€šè¿‡ä½¿ç”¨ <em>bs4</em> è§£æå¥½å‹éªŒè¯æ¶ˆæ¯(ç±»å‹ä¸º37)contentå­—æ®µåå¯ä»¥å¾—åˆ° <code>v3</code>å’Œ<code>v4</code>å­—æ®µ, é€šè¿‡è¿™ä¸¤ä¸ªå­—æ®µå¯ä»¥è°ƒç”¨å¾®ä¿¡æ¥å£ä»è€Œå®ç°è‡ªåŠ¨æ·»åŠ å¥½å‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plugins/AcceptFriend/main.py</span></span><br><span class="line"><span class="meta">@on_other_message</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handleRequest</span>(<span class="params">self, bot: LegendWechatBot, msg: WxMsg</span>):</span><br><span class="line">    <span class="comment"># å¦‚æœåŠŸèƒ½æœªå¯ç”¨æˆ–æ¶ˆæ¯ç±»å‹ä¸æ˜¯37ï¼Œåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.enable <span class="keyword">or</span> msg.<span class="built_in">type</span> != <span class="number">37</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨BeautifulSoupè§£ææ¶ˆæ¯å†…å®¹</span></span><br><span class="line">    bs = BeautifulSoup(msg.content, <span class="string">&#x27;lxml-xml&#x27;</span>)</span><br><span class="line">    <span class="comment"># æŸ¥æ‰¾æ¶ˆæ¯å…ƒç´ </span></span><br><span class="line">    msg_ = bs.find(<span class="string">&#x27;msg&#x27;</span>)</span><br><span class="line">    <span class="comment"># å¦‚æœæ‰¾åˆ°äº†æ¶ˆæ¯å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> msg_:</span><br><span class="line">        <span class="comment"># è·å–åœºæ™¯å€¼</span></span><br><span class="line">        scene = <span class="built_in">int</span>(msg_.get(<span class="string">&#x27;scene&#x27;</span>))</span><br><span class="line">        <span class="comment"># è·å–åŠ å¯†ç”¨æˆ·å</span></span><br><span class="line">        v3 = msg_.get(<span class="string">&#x27;encryptusername&#x27;</span>)</span><br><span class="line">        <span class="comment"># è·å–ç¥¨æ®</span></span><br><span class="line">        v4 = msg_.get(<span class="string">&#x27;ticket&#x27;</span>)</span><br><span class="line">        <span class="comment"># è·å–ç”¨æˆ·å</span></span><br><span class="line">        userName = msg_.get(<span class="string">&#x27;fromusername&#x27;</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœæ¥å—æ–°å¥½å‹è¯·æ±‚æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> bot.accept_new_friend(v3, v4, scene):</span><br><span class="line">            <span class="comment"># è®°å½•æˆåŠŸä¿¡æ¯</span></span><br><span class="line">            logger.success(<span class="string">f&#x27;å·²æ¥å—å¥½å‹è¯·æ±‚: <span class="subst">&#123;userName&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># è®°å½•å¤±è´¥ä¿¡æ¯</span></span><br><span class="line">            logger.warning(<span class="string">f&#x27;æ¥å—å¥½å‹è¯·æ±‚å¤±è´¥: <span class="subst">&#123;userName&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ¶ˆæ¯å…ƒç´ ï¼Œåˆ™è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ·»åŠ æ–°å¥½å‹å, ç³»ç»Ÿä¼šå‘é€ä¸€æ¡æ¶ˆæ¯(ç±»å‹ä¸º10000), æ¶ˆæ¯å†…å®¹ä¸º <code>ä½ å·²æ·»åŠ äº†XXX,ç°åœ¨å¯ä»¥å¼€å§‹èŠå¤©äº†</code>, æ­¤æ—¶éœ€è¦é€šè¿‡ <em>bs4</em> è§£ææ¶ˆæ¯å†…å®¹, è·å–åˆ°æ–°å¥½å‹çš„ <code>id</code> å’Œ <code>name</code>, åŒæ—¶å‘é€æ¬¢è¿æ¶ˆæ¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plugins/AcceptFriend/main.py</span></span><br><span class="line"><span class="meta">@on_system_message</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handleNewFriend</span>(<span class="params">self, bot: LegendWechatBot, msg: WxMsg</span>):</span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¶ˆæ¯å†…å®¹ï¼Œè·å–æ–°æœ‹å‹çš„æ˜µç§°</span></span><br><span class="line">    nickName = re.findall(<span class="string">r&quot;ä½ å·²æ·»åŠ äº†(.*)ï¼Œç°åœ¨å¯ä»¥å¼€å§‹èŠå¤©äº†ã€‚&quot;</span>, msg.content)</span><br><span class="line">    <span class="comment"># å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ–°æœ‹å‹çš„æ˜µç§°èµ‹å€¼ç»™nickNameå˜é‡</span></span><br><span class="line">    <span class="keyword">if</span> nickName:</span><br><span class="line">        nickName = nickName[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># å¦‚æœæ–°æœ‹å‹çš„æ˜µç§°å­˜åœ¨ï¼Œä¸”å¯ç”¨äº†æ–°æœ‹å‹å¤„ç†åŠŸèƒ½ï¼Œä¸”æ¶ˆæ¯ç±»å‹ä¸º10000æˆ–10002ï¼Œåˆ™å‘é€æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">if</span> nickName <span class="keyword">and</span> <span class="variable language_">self</span>.enable:</span><br><span class="line">        bot.sendMsg(<span class="string">f&#x27;ä½ å¥½å‘€, <span class="subst">&#123;nickName&#125;</span>&#x27;</span>, msg.sender, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¾¤èŠæ–°æˆå‘˜æ¬¢è¿"><a href="#ç¾¤èŠæ–°æˆå‘˜æ¬¢è¿" class="headerlink" title="ç¾¤èŠæ–°æˆå‘˜æ¬¢è¿"></a>ç¾¤èŠæ–°æˆå‘˜æ¬¢è¿</h3><p>é€šè¿‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£ææ¶ˆæ¯å†…å®¹, è·å–åˆ°æ–°æˆå‘˜çš„ <code>id</code> å’Œ <code>name</code>, å¹¶æŸ¥è¯¢å¾®ä¿¡æ•°æ®åº“, è·å–åˆ°ç”¨æˆ·å¤´åƒé“¾æ¥, æ•´åˆè‡³æ¬¢è¿æ¶ˆæ¯ä¸­å‘é€ç»™æ–°æˆå‘˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plugins/GroupWelcome/main.py</span></span><br><span class="line"><span class="meta">@on_system_message</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">groupWelcome</span>(<span class="params">self, bot: LegendWechatBot, message: WxMsg</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.enable:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä¸æ˜¯ç¾¤èŠæ¶ˆæ¯ï¼Œåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> message.from_group():</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ¶ˆæ¯ç±»å‹ä¸æ˜¯10000æˆ–10002ï¼Œåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> message.<span class="built_in">type</span> != <span class="number">10000</span> <span class="keyword">and</span> message.<span class="built_in">type</span> != <span class="number">10002</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœç¾¤èŠä¸åœ¨ç™½åå•ä¸­ï¼Œåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> LegendBotDB().get_chatroom_whitelist(message.roomid):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ¶ˆæ¯å†…å®¹ä¸­åŒ…å«é‚€è¯·åŠ å…¥ç¾¤èŠçš„ä¿¡æ¯ï¼Œåˆ™è§£ææˆå‘˜ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> re.findall(<span class="string">r&#x27;&quot;(.*?)&quot;é‚€è¯·&quot;(.*?)&quot;åŠ å…¥äº†ç¾¤èŠ&#x27;</span>, message.content):  <span class="comment"># é€šè¿‡é‚€è¯·åŠ å…¥ç¾¤èŠ</span></span><br><span class="line">        new_members = <span class="variable language_">self</span>._parse_member_info(bot, message, <span class="string">&quot;invitation&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> re.findall(<span class="string">r&#x27;&quot;(.*)&quot;åŠ å…¥äº†ç¾¤èŠ&#x27;</span>, message.content):  <span class="comment"># ç›´æ¥åŠ å…¥ç¾¤èŠ</span></span><br><span class="line">        new_members = <span class="variable language_">self</span>._parse_member_info(bot, message, <span class="string">&quot;direct&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> re.findall(<span class="string">r&#x27;&quot;(.*?)&quot;é€šè¿‡(.*?)åŠ å…¥ç¾¤èŠ&#x27;</span>, message.content):  <span class="comment"># é€šè¿‡é‚€è¯·é“¾æ¥åŠ å…¥ç¾¤èŠ</span></span><br><span class="line">        new_members = <span class="variable language_">self</span>._parse_member_info(bot, message, <span class="string">&quot;inviters&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logger.warning(<span class="string">f&quot;æœªçŸ¥çš„å…¥ç¾¤æ–¹å¼: &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> new_members:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> member <span class="keyword">in</span> new_members:</span><br><span class="line">        wxid = member[<span class="string">&quot;wxid&quot;</span>]</span><br><span class="line">        nickname = member[<span class="string">&quot;nickname&quot;</span>]</span><br><span class="line"></span><br><span class="line">        now = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        <span class="comment"># æ“ä½œå¾®ä¿¡æ•°æ®åº“, ä»æŒ‡å®šè¡¨é‡ŒæŸ¥è¯¢æŒ‡å®šwxidçš„bigHeadImgUrl</span></span><br><span class="line">        img = bot.query_sql(<span class="string">&#x27;MicroMsg.db&#x27;</span>, <span class="string">f&#x27;SELECT bigHeadImgUrl FROM ContactHeadImgUrl WHERE usrName=&quot;<span class="subst">&#123;wxid&#125;</span>&quot;;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> img:</span><br><span class="line">            img = img[<span class="number">0</span>][<span class="string">&#x27;bigHeadImgUrl&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            img = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        logger.debug(<span class="string">f&quot;<span class="subst">&#123;nickname&#125;</span> <span class="subst">&#123;<span class="built_in">str</span>(wxid)&#125;</span> <span class="subst">&#123;img&#125;</span> åŠ å…¥äº†ç¾¤èŠ&quot;</span>)</span><br><span class="line">        bot.send_rich_text(nickname, <span class="built_in">str</span>(wxid), <span class="string">f&quot;ğŸ‘æ¬¢è¿ <span class="subst">&#123;nickname&#125;</span> åŠ å…¥ç¾¤èŠ!ğŸ‰&quot;</span>, <span class="string">f&quot;âŒšæ—¶é—´ï¼š<span class="subst">&#123;now&#125;</span>\n<span class="subst">&#123;self.welcome_message&#125;</span>\nğŸ”—ç‚¹å‡»æŸ¥çœ‹æ›´å¤šä¿¡æ¯&quot;</span>, <span class="string">&#x27;https://kanwuqing.github.io&#x27;</span>, img, message.roomid)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_parse_member_info</span>(<span class="params">bot: Wcf, message: WxMsg, link: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    user = []</span><br><span class="line">    <span class="comment"># ç›´æ¥åŠ ç¾¤</span></span><br><span class="line">    <span class="keyword">if</span> link == <span class="string">&quot;direct&quot;</span>:</span><br><span class="line">        pattern = <span class="string">r&#x27;&quot;(.*)&quot;åŠ å…¥äº†ç¾¤èŠ&#x27;</span></span><br><span class="line">        user = re.findall(pattern, message.content)[<span class="number">0</span>].split(<span class="string">&quot;ã€&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åŒ¿åé‚€è¯·åŠ ç¾¤</span></span><br><span class="line">    <span class="keyword">elif</span> link == <span class="string">&quot;inviters&quot;</span>:</span><br><span class="line">        pattern = <span class="string">r&#x27;&quot;(.*?)&quot;é€šè¿‡(.*?)åŠ å…¥ç¾¤èŠ&#x27;</span></span><br><span class="line">        user = re.findall(pattern, message.content)[<span class="number">0</span>][<span class="number">0</span>].split(<span class="string">&quot;ã€&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é‚€è¯·åŠ ç¾¤</span></span><br><span class="line">    <span class="keyword">elif</span> link == <span class="string">&quot;invitation&quot;</span>:</span><br><span class="line">        pattern = <span class="string">r&#x27;&quot;(.*?)&quot;é‚€è¯·&quot;(.*?)&quot;åŠ å…¥äº†ç¾¤èŠ&#x27;</span></span><br><span class="line">        user = re.findall(pattern, message.content)[<span class="number">0</span>][<span class="number">1</span>].split(<span class="string">&quot;ã€&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    users = []</span><br><span class="line">    <span class="comment"># æš‚åœ3ç§’</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># è·å–ç¾¤èŠæˆå‘˜ä¿¡æ¯</span></span><br><span class="line">    mem = bot.get_chatroom_members(message.roomid)</span><br><span class="line">    <span class="comment"># æ‰“å°ç¾¤èŠæˆå‘˜ä¿¡æ¯</span></span><br><span class="line">    logger.debug(mem)</span><br><span class="line">    <span class="comment"># éå†ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> user:</span><br><span class="line">        <span class="comment"># å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°usersåˆ—è¡¨ä¸­</span></span><br><span class="line">        users.append(&#123;<span class="string">&quot;wxid&quot;</span>: get_key(mem, i), <span class="string">&quot;nickname&quot;</span>: i&#125;)</span><br><span class="line">    <span class="comment"># è¿”å›ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> users</span><br></pre></td></tr></table></figure>

<h3 id="ä¸­è¯è¯æ–¹æŸ¥è¯¢"><a href="#ä¸­è¯è¯æ–¹æŸ¥è¯¢" class="headerlink" title="ä¸­è¯è¯æ–¹æŸ¥è¯¢"></a>ä¸­è¯è¯æ–¹æŸ¥è¯¢</h3><p>åœ¨å®Œæˆåˆ›æ–°é¡¹ç›®æ—¶, æˆ‘æƒ³åˆ°äº†é€šè¿‡å¾®ä¿¡æ¥æ­å»ºä¸­åŒ»é—®è¯Šè‡ªåŠ¨åŒ–çš„å¹³å°. æ°å¥½æœ¬äººåœ¨ä¸­åŒ»æ–¹é¢ä¹Ÿç•¥æ‡‚ä¸€äº›çš®æ¯›, ç»“åˆè‡ªå·±å¯¹äºä¸åŒè¯æ–¹çš„ç—…ç—‡çš„æ±‡æ€»ä¸æ•´ç†, ä¾¿é€šè¿‡å†³ç­–æ ‘å®ç°äº†è¿™ä¸€åŠŸèƒ½.</p>
<ul>
<li><p>å¤šè½®å¯¹è¯å®ç°æ–¹å¼</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plugins\TCM\main.py</span></span><br><span class="line"><span class="variable language_">self</span>.users = &#123;&#125; <span class="comment"># æ­£åœ¨é—®è¯Šçš„ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">if</span> msg.content.startswith(<span class="string">&#x27;q &#x27;</span>):</span><br><span class="line"><span class="comment"># å¦‚æœè¯¥ç”¨æˆ·å·²ç»åœ¨é—®è¯Šä¸­ï¼Œåˆ™å‘é€æç¤ºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> msg.sender <span class="keyword">in</span> <span class="variable language_">self</span>.users:</span><br><span class="line">    bot.sendMsg(<span class="string">&quot;ä½ å·²ç»å¤„äºä¸€ä¸ªé—®è¯Šä¸­äº†, é»‘åå•æŒ‡æ•°+1, è¯·æ³¨æ„&quot;</span>, to, at)</span><br><span class="line">    <span class="comment"># å°†è¯¥ç”¨æˆ·åŠ å…¥é»‘åå•ï¼Œé»‘åå•æŒ‡æ•°+1</span></span><br><span class="line">    <span class="keyword">await</span> LegendBotDB.add_black(wxid=msg.sender, n=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°é—®è¯ŠçŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> msg.content <span class="keyword">in</span> <span class="variable language_">self</span>.users[msg.sender]:</span><br><span class="line">    <span class="variable language_">self</span>.users[msg.sender] = <span class="variable language_">self</span>.users[msg.sender][msg.content]</span><br></pre></td></tr></table></figure>
</li>
<li><p>å†³ç­–æ ‘å®ç°æ–¹å¼</p>
<p>  <img src="/Week2%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/map.png" alt="å†³ç­–æ ‘"></p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;!--</span> <span class="string">ä»¥æ¡‚ææ±¤ç³»ä¸ºä¾‹</span> <span class="string">--&gt;</span></span><br><span class="line"><span class="string">æ¡‚ææ±¤:</span></span><br><span class="line">  <span class="attr">q:</span> <span class="string">å‘çƒ­å—?(æœ‰/æ²¡æœ‰)</span></span><br><span class="line">  <span class="string">æœ‰:</span></span><br><span class="line">    <span class="attr">q:</span> <span class="string">å¤´éƒ¨åé¢ˆæœ‰ç‰µæ‰¯ä¸é€‚çš„æ„Ÿè§‰å—?(æœ‰/æ²¡æœ‰)</span></span><br><span class="line">    <span class="string">æœ‰:</span></span><br><span class="line">      <span class="attr">q:</span> <span class="string">å…¨èº«é…¸ç—›å—?(é…¸ç—›/ä¸é…¸ç—›)</span></span><br><span class="line">      <span class="string">é…¸ç—›:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">å¹³æ—¶æœ‰æ±—å—?(æœ‰/æ²¡æœ‰)</span></span><br><span class="line">        <span class="string">æœ‰:</span> <span class="string">æ¡‚æåŠ è‘›æ ¹æ±¤</span></span><br><span class="line">        <span class="string">æ²¡æœ‰:</span> <span class="string">è‘›æ ¹æ±¤</span></span><br><span class="line">      <span class="string">ä¸é…¸ç—›:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">ç—‰(æŒ›),</span> <span class="string">è§’å¼“åå¼ ,</span> <span class="string">å³å¤´å’Œä¸‹è‚¢åå¼¯,</span> <span class="string">èº¯å¹²å‘å‰;</span> <span class="string">æˆ–æ˜¯æ€•é£/è‡ªå‘æ€§å‡ºæ±—å—?(ç—‰ç—‡/æ¶é£æœ‰æ±—)</span></span><br><span class="line">        <span class="string">ç—‰ç—‡:</span> <span class="string">æ è’Œæ¡‚ææ±¤</span></span><br><span class="line">        <span class="string">æ¶é£æœ‰æ±—:</span> <span class="string">æ¡‚ææ±¤</span></span><br><span class="line">    <span class="string">æ²¡æœ‰:</span></span><br><span class="line">      <span class="attr">q:</span> <span class="string">å¹³æ—¶ä½“åŠ›ä½“è´¨å¥½å—?(å¥½/ä¸å¥½)</span></span><br><span class="line">      <span class="string">å¥½:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">å’½ç‚,</span> <span class="string">å’½éƒ¨éš¾å—;</span> <span class="string">æˆ–æ˜¯è‡ªè§‰æ€•å†·,</span> <span class="string">å“ªæ€•åŠ è¡£æœé è¿‘æš–æ°”ä¹Ÿä¸è§å¥½,</span> <span class="string">ä¸”åŒæ—¶å‘çƒ­?(å’½ç‚/æ¶å¯’å‘çƒ­)</span></span><br><span class="line">        <span class="string">å’½ç‚:</span> <span class="string">æ¡‚æäºŒè¶Šå©¢ä¸€æ±¤</span></span><br><span class="line">        <span class="string">æ¶å¯’å‘çƒ­:</span> <span class="string">éº»æ¡‚å„åŠæ±¤</span></span><br><span class="line">      <span class="string">ä¸å¥½:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">æœ‰æ—¶è‡ªè§‰æ€•å†·,</span> <span class="string">å“ªæ€•åŠ è¡£æœé è¿‘æš–æ°”ä¹Ÿä¸è§å¥½,</span> <span class="string">æœ‰æ—¶å‘çƒ­;</span> <span class="string">æˆ–æ˜¯è‚šå­ç–¼,</span> <span class="string">é£Ÿæ¬²ä¸æŒ¯?(å¾€æ¥å¯’çƒ­/è…¹ç—›)</span></span><br><span class="line">        <span class="string">å¾€æ¥å¯’çƒ­:</span> <span class="string">æŸ´èƒ¡æ¡‚ææ±¤</span></span><br><span class="line">        <span class="string">è…¹ç—›:</span> <span class="string">å°å»ºä¸­æ±¤</span></span><br><span class="line">  <span class="string">æ²¡æœ‰:</span></span><br><span class="line">    <span class="attr">q:</span> <span class="string">è‚šå­ç–¼å—?(ç–¼/ä¸ç–¼)</span></span><br><span class="line">    <span class="string">ç–¼:</span></span><br><span class="line">      <span class="attr">q:</span> <span class="string">æ€•å†·ä½†æ˜¯å¯é€šè¿‡ç©¿è¡£æœç­‰æ“ä½œç¼“è§£å—?(æ˜¯/ä¸æ˜¯)</span></span><br><span class="line">      <span class="string">æ˜¯:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">å”¾æ¶²å¤š;</span> <span class="string">æˆ–æ˜¯èº«ä½“å±€éƒ¨æ°”è¡€ä¸é€š,</span> <span class="string">èƒ¸é—·/æ‰‹è„šå†·/ç—‰(æŒ›),</span> <span class="string">è§’å¼“åå¼ ,</span> <span class="string">å³å¤´å’Œä¸‹è‚¢åå¼¯,</span> <span class="string">èº¯å¹²å‘å‰ç­‰?(å”¾æ¶²å¤š/æ°”è¡€ä¸é€š)</span></span><br><span class="line">        <span class="string">å”¾æ¶²å¤š:</span> <span class="string">å½“å½’å››é€†åŠ å´èŒ±è¸ç”Ÿå§œæ±¤</span></span><br><span class="line">        <span class="string">æ°”è¡€ä¸é€š:</span> <span class="string">å½“å½’å››é€†æ±¤</span></span><br><span class="line">      <span class="string">ä¸æ˜¯:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">å¤±çœ å—?(æœ‰/æ²¡æœ‰)</span></span><br><span class="line">        <span class="string">æœ‰:</span> <span class="string">æ¡‚æåŠ é¾™éª¨ç‰¡è›æ±¤</span></span><br><span class="line">        <span class="string">æ²¡æœ‰:</span></span><br><span class="line">          <span class="attr">q:</span> <span class="string">è‚šå­èƒ€;</span> <span class="string">æˆ–æ˜¯ä¾¿ç§˜?(è‚šå­èƒ€/ä¾¿ç§˜)</span></span><br><span class="line">          <span class="string">è‚šå­èƒ€:</span> <span class="string">æ¡‚æåŠ èŠè¯æ±¤</span></span><br><span class="line">          <span class="string">ä¾¿ç§˜:</span> <span class="string">æ¡‚æåŠ å¤§é»„æ±¤</span></span><br><span class="line">    <span class="string">ä¸ç–¼:</span></span><br><span class="line">      <span class="attr">q:</span> <span class="string">æ€•å†·ä½†æ˜¯å¯é€šè¿‡ç©¿è¡£æœç­‰æ“ä½œç¼“è§£å—?(æ˜¯/ä¸æ˜¯)</span></span><br><span class="line">      <span class="string">æ˜¯:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">å¿ƒçƒ¦;</span> <span class="string">æˆ–æ˜¯å°ä¾¿å›°éš¾,</span> <span class="string">å››è‚¢æ´»åŠ¨å—é™?(å¿ƒçƒ¦/å°ä¾¿å›°éš¾)</span></span><br><span class="line">        <span class="string">å¿ƒçƒ¦:</span> <span class="string">æ¡‚æé™„å­æ±¤</span></span><br><span class="line">        <span class="string">å°ä¾¿å›°éš¾:</span> <span class="string">æ¡‚æåŠ é™„å­æ±¤</span></span><br><span class="line">      <span class="string">ä¸æ˜¯:</span></span><br><span class="line">        <span class="attr">q:</span> <span class="string">æœ‰é¼»æ¶•,</span> <span class="string">è¾ƒæµ“,</span> <span class="string">å¯èƒ½è¿˜ä¼šæµåˆ°å’½éƒ¨;</span> <span class="string">æˆ–æ˜¯çš®è‚¤è¡¨é¢æœ‰æ°´è‚¿,</span> <span class="string">æœ‰é»„è‰²çš„æ±—?(é¼»æ¶•/é»„æ±—)</span></span><br><span class="line">        <span class="string">é¼»æ¶•:</span> <span class="string">è‘›æ ¹æ±¤åŠ å·èŠè¾›å¤·</span></span><br><span class="line">        <span class="string">é»„æ±—:</span> <span class="string">æ¡‚æåŠ é»„è€†æ±¤</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
<li><p>é¦–è½®é—®è¯¢ä¸­ç›¸å…³æ€§åŒ¹é…å®ç°æ–¹å¼</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_most_similar_question</span>(<span class="params">tree, user_input</span>):</span><br><span class="line">    <span class="comment"># éå†æ ‘å½¢ç»“æ„ï¼Œè¿”å›æ‰€æœ‰é—®é¢˜åŠå…¶è·¯å¾„</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">traverse_tree</span>(<span class="params">tree, path=[]</span>):</span><br><span class="line">        <span class="comment"># å®šä¹‰ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨é—®é¢˜åŠå…¶è·¯å¾„</span></span><br><span class="line">        questions = []</span><br><span class="line">        <span class="comment"># éå†æ ‘å½¢ç»“æ„çš„æ¯ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> tree.items():</span><br><span class="line">            <span class="comment"># å¦‚æœèŠ‚ç‚¹çš„å€¼æ˜¯ä¸€ä¸ªå­—å…¸</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>):</span><br><span class="line">                <span class="comment"># å¦‚æœå­—å…¸ä¸­åŒ…å«é—®é¢˜</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;q&#x27;</span> <span class="keyword">in</span> value:</span><br><span class="line">                    <span class="comment"># å°†é—®é¢˜åŠå…¶è·¯å¾„æ·»åŠ åˆ°åˆ—è¡¨ä¸­</span></span><br><span class="line">                    questions.append((value[<span class="string">&#x27;q&#x27;</span>], path + [key]))</span><br><span class="line">                <span class="comment"># é€’å½’è°ƒç”¨traverse_treeå‡½æ•°ï¼Œç»§ç»­éå†å­èŠ‚ç‚¹</span></span><br><span class="line">                questions.extend(traverse_tree(value, path + [key]))</span><br><span class="line">        <span class="comment"># è¿”å›é—®é¢˜åŠå…¶è·¯å¾„çš„åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">return</span> questions</span><br><span class="line"></span><br><span class="line">    questions = traverse_tree(tree)</span><br><span class="line">    question_texts = [q[<span class="number">0</span>] <span class="keyword">for</span> q <span class="keyword">in</span> questions]</span><br><span class="line">    most_similar = difflib.get_close_matches(user_input, question_texts, n=<span class="number">3</span>, cutoff=<span class="number">0.0</span>)</span><br><span class="line">    </span><br><span class="line">    paths = []</span><br><span class="line">    ques = []</span><br><span class="line">    <span class="keyword">if</span> most_similar:</span><br><span class="line">        <span class="keyword">for</span> question, path <span class="keyword">in</span> questions:</span><br><span class="line">            <span class="keyword">if</span> question <span class="keyword">in</span> most_similar:</span><br><span class="line">                paths.append(path)</span><br><span class="line">                ques.append(question)</span><br><span class="line">        <span class="keyword">return</span> paths, ques</span><br><span class="line">    <span class="keyword">return</span> [], []</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å¼ ç»´ä¸ºè¡¨æƒ…åŒ…æŸ¥è¯¢"><a href="#å¼ ç»´ä¸ºè¡¨æƒ…åŒ…æŸ¥è¯¢" class="headerlink" title="å¼ ç»´ä¸ºè¡¨æƒ…åŒ…æŸ¥è¯¢"></a>å¼ ç»´ä¸ºè¡¨æƒ…åŒ…æŸ¥è¯¢</h3><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­, å¥½å‹ <em>Daniel</em> åŸºäº<code>bge-large-zhä¸­æ–‡åµŒå…¥æ¨¡å‹</code>æ¨¡å‹å¼€æºäº†ä¸€ä¸ªå¼ ç»´ä¸ºè¡¨æƒ…åŒ…åŒ¹é…ç½‘ç«™ <a target="_blank" rel="noopener" href="https://github.com/DanielZhangyc/VVQuest">VVQuest</a>, æˆ‘å°†å…¶å¤„ç†æˆæ’ä»¶å½¢å¼, åˆ é™¤äº†ä¸éœ€è¦çš„éƒ¨åˆ†(å¦‚å‰ç«¯), å¹¶å°†å…¶é›†æˆåˆ°é¡¹ç›®ä¸­.</p>
<ul>
<li><p>äºŒæ¬¡å¼€å‘<br>é¦–æ¬¡è¿è¡Œå‰è¯·è‡ªè¡Œä¸‹è½½<code>bge-large-zh</code>æ¨¡å‹, å¹¶å°†å…¶æ”¾ç½®åœ¨<code>plugins/VVQuest/data/models</code>ç›®å½•ä¸‹.<br>é¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆç¼“å­˜, è¯·è€å¿ƒç­‰å¾…</p>
</li>
<li><p>ä»£ç å‡ºå¤„åŠè¯¦ç»†å¼€å‘æ–‡æ¡£è¯·å‚è§ <a target="_blank" rel="noopener" href="https://github.com/DanielZhangyc/VVQuest">VVQuest</a></p>
</li>
</ul>
<h3 id="æ•æ„Ÿè¯æ£€æµ‹"><a href="#æ•æ„Ÿè¯æ£€æµ‹" class="headerlink" title="æ•æ„Ÿè¯æ£€æµ‹"></a>æ•æ„Ÿè¯æ£€æµ‹</h3><p>ç”±äºåŸºäºå¾®ä¿¡å¹³å°, å¹¶å¯¹å…¬ä¼—å¼€æ”¾, æ‰€ä»¥éœ€è¦é’ˆå¯¹æŸäº›æŸå®³å…¬å…±åˆ©ç›Šä»¥åŠç¯å¢ƒçš„è¡Œä¸ºè¿›è¡Œæ£€æµ‹, å…¶ä¸­å°±åŒ…å«äº†æ•æ„Ÿè¯æ£€æµ‹, åœ¨å¼€å‘è¿‡ç¨‹ä¸­, æˆ‘ç¼–å†™äº†æ•æ„Ÿè¯æ£€æµ‹ç¨‹åºå¹¶é›†æˆäº†æ•æ„Ÿè¯åº“å­˜æ”¾åœ¨docs&#x2F;ban.txt</p>
<ul>
<li>æ•æ„Ÿè¯æ£€æµ‹ç¨‹åº</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DFA</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ban_words_set = <span class="built_in">set</span>()</span><br><span class="line">        <span class="variable language_">self</span>.ban_words_list = []</span><br><span class="line">        <span class="variable language_">self</span>.ban_words_dict = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.path = <span class="string">&#x27;docs/ban.txt&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.get_words()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–æ•æ„Ÿè¯åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_words</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> f:</span><br><span class="line">                <span class="keyword">if</span> s.find(<span class="string">&#x27;\\r&#x27;</span>):</span><br><span class="line">                    s = s.replace(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                s = s.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                s = s.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">str</span>(s) <span class="keyword">and</span> s <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.ban_words_set:</span><br><span class="line">                    <span class="variable language_">self</span>.ban_words_set.add(s)</span><br><span class="line">                    <span class="variable language_">self</span>.ban_words_list.append(<span class="built_in">str</span>(s))</span><br><span class="line">        <span class="variable language_">self</span>.add_hash_dict(<span class="variable language_">self</span>.ban_words_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ•æ„Ÿè¯åˆ—è¡¨è½¬æ¢ä¸ºDFAå­—å…¸åº</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_hash_dict</span>(<span class="params">self, new_list</span>):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> new_list:</span><br><span class="line">            <span class="variable language_">self</span>.add_new_word(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ å•ä¸ªæ•æ„Ÿè¯</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_new_word</span>(<span class="params">self, new_word</span>):</span><br><span class="line">        new_word = <span class="built_in">str</span>(new_word)</span><br><span class="line">        <span class="comment"># print(new_word)</span></span><br><span class="line">        now_dict = <span class="variable language_">self</span>.ban_words_dict</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> new_word:</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> now_dict:</span><br><span class="line">                x = <span class="built_in">str</span>(x)</span><br><span class="line">                new_dict = <span class="built_in">dict</span>()</span><br><span class="line">                new_dict[<span class="string">&#x27;is_end&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">                now_dict[x] = new_dict</span><br><span class="line">                now_dict = new_dict</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                now_dict = now_dict[x]</span><br><span class="line">            <span class="keyword">if</span> i == <span class="built_in">len</span>(new_word) - <span class="number">1</span>:</span><br><span class="line">                now_dict[<span class="string">&#x27;is_end&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯»æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°æ•æ„Ÿè¯çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_illegal</span>(<span class="params">self, _<span class="built_in">str</span></span>):</span><br><span class="line">        now_dict = <span class="variable language_">self</span>.ban_words_dict</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        start_word = -<span class="number">1</span></span><br><span class="line">        is_start = <span class="literal">True</span>  <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ•æ„Ÿè¯çš„å¼€å§‹</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(_<span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">if</span> _<span class="built_in">str</span>[i] <span class="keyword">not</span> <span class="keyword">in</span> now_dict:</span><br><span class="line">                <span class="keyword">if</span> is_start <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                i = start_word +<span class="number">1</span></span><br><span class="line">                start_word = -<span class="number">1</span></span><br><span class="line">                is_start = <span class="literal">True</span></span><br><span class="line">                now_dict = <span class="variable language_">self</span>.ban_words_dict</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> is_start <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                    start_word = i</span><br><span class="line">                    is_start = <span class="literal">False</span></span><br><span class="line">                now_dict = now_dict[_<span class="built_in">str</span>[i]]</span><br><span class="line">                <span class="keyword">if</span> now_dict[<span class="string">&#x27;is_end&#x27;</span>] <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                    <span class="keyword">return</span> start_word</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨æ•æ„Ÿè¯</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exists</span>(<span class="params">self, s</span>):</span><br><span class="line">        pos = <span class="variable language_">self</span>.find_illegal(s)</span><br><span class="line">        <span class="keyword">if</span> pos == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æŒ‡å®šä½ç½®çš„æ•æ„Ÿè¯æ›¿æ¢ä¸º*</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_words</span>(<span class="params">self, filter_str, pos</span>):</span><br><span class="line">        now_dict = <span class="variable language_">self</span>.ban_words_dict</span><br><span class="line">        end_str = <span class="built_in">int</span>()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pos, <span class="built_in">len</span>(filter_str)):</span><br><span class="line">            <span class="keyword">if</span> now_dict[filter_str[i]][<span class="string">&#x27;is_end&#x27;</span>] <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                end_str = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            now_dict = now_dict[filter_str[i]]</span><br><span class="line">        num = end_str - pos + <span class="number">1</span></span><br><span class="line">        filter_str = filter_str[:pos] + <span class="string">&#x27;*&#x27;</span>*num + filter_str[end_str + <span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">return</span> filter_str</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_all</span>(<span class="params">self, s</span>):</span><br><span class="line">        pos_list = <span class="built_in">list</span>()</span><br><span class="line">        ss = <span class="variable language_">self</span>.draw_words(s, pos_list)</span><br><span class="line">        illegal_pos = <span class="variable language_">self</span>.find_illegal(ss)</span><br><span class="line">        <span class="keyword">while</span> illegal_pos != -<span class="number">1</span>:</span><br><span class="line">            ss = <span class="variable language_">self</span>.filter_words(ss, illegal_pos)</span><br><span class="line">            illegal_pos = <span class="variable language_">self</span>.find_illegal(ss)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(ss):</span><br><span class="line">            <span class="keyword">if</span> ss[i] == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                start = pos_list[i]</span><br><span class="line">                <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(ss) <span class="keyword">and</span> ss[i] == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                i -=<span class="number">1</span></span><br><span class="line">                end = pos_list[i]</span><br><span class="line">                num = end-start+<span class="number">1</span></span><br><span class="line">                s = s[:start] + <span class="string">&#x27;*&#x27;</span>*num + s[end+<span class="number">1</span>:]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_words</span>(<span class="params">_<span class="built_in">str</span>, pos_list</span>):</span><br><span class="line">        ss = <span class="built_in">str</span>()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(_<span class="built_in">str</span>)):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;\u4e00&#x27;</span> &lt;= _<span class="built_in">str</span>[i] &lt;= <span class="string">&#x27;\u9fa5&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;\u3400&#x27;</span> &lt;= _<span class="built_in">str</span>[i] &lt;= <span class="string">&#x27;\u4db5&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;\u0030&#x27;</span> &lt;= _<span class="built_in">str</span>[i] &lt;= <span class="string">&#x27;\u0039&#x27;</span> \</span><br><span class="line">                    <span class="keyword">or</span> <span class="string">&#x27;\u0061&#x27;</span> &lt;= _<span class="built_in">str</span>[i] &lt;= <span class="string">&#x27;\u007a&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;\u0041&#x27;</span> &lt;= _<span class="built_in">str</span>[i] &lt;= <span class="string">&#x27;\u005a&#x27;</span>:</span><br><span class="line">                ss += _<span class="built_in">str</span>[i]</span><br><span class="line">                pos_list.append(i)</span><br><span class="line">        <span class="keyword">return</span> ss</span><br></pre></td></tr></table></figure>

<p>æ•æ„Ÿè¯éœ€è¦åœ¨æ‰€æœ‰æ’ä»¶å¤„ç†å‰å•ç‹¬åˆ¤æ–­, å› æ­¤ä¸ä½œä¸ºæ’ä»¶å‡ºç°</p>
<ul>
<li>æ•æ„Ÿè¯æ£€æµ‹é€»è¾‘</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> dfa.exists(msg.content):</span><br><span class="line">    <span class="variable language_">self</span>.DB.add_black(msg.sender, <span class="number">2</span>)</span><br><span class="line">    <span class="variable language_">self</span>.bot.sendMsg(<span class="string">&#x27;è¯´è¯å¤ªåˆ‘äº†, é»‘åå•æŒ‡æ•°+2, è¯·æ³¨æ„&#x27;</span>, to, at)</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure>


<h2 id="ç¤¾åŒºè´¡çŒ®æŒ‡å—"><a href="#ç¤¾åŒºè´¡çŒ®æŒ‡å—" class="headerlink" title="ç¤¾åŒºè´¡çŒ®æŒ‡å—"></a>ç¤¾åŒºè´¡çŒ®æŒ‡å—</h2><h3 id="ğŸš©-æäº¤ä»£ç æ—¶è¯·ä½¿ç”¨æ ‡å‡†åŒ–-Commit-Messageï¼š"><a href="#ğŸš©-æäº¤ä»£ç æ—¶è¯·ä½¿ç”¨æ ‡å‡†åŒ–-Commit-Messageï¼š" class="headerlink" title="ğŸš© æäº¤ä»£ç æ—¶è¯·ä½¿ç”¨æ ‡å‡†åŒ– Commit Messageï¼š"></a>ğŸš© æäº¤ä»£ç æ—¶è¯·ä½¿ç”¨æ ‡å‡†åŒ– Commit Messageï¼š</h3><ul>
<li><code>feat</code>: æ–°åŠŸèƒ½</li>
<li><code>fix</code>: Bugä¿®å¤</li>
<li><code>docs</code>: æ–‡æ¡£æ›´æ–°</li>
<li><code>style</code>: ä»£ç æ ¼å¼</li>
<li><code>ref</code>: ä»£ç é‡æ„</li>
<li><code>perf</code>: æ€§èƒ½ä¼˜åŒ–</li>
<li><code>test</code>: æµ‹è¯•ç›¸å…³</li>
<li><code>chore</code>: æ„å»º&#x2F;å·¥å…·å˜æ›´</li>
</ul>
<h3 id="æäº¤è´¡çŒ®æ­¥éª¤"><a href="#æäº¤è´¡çŒ®æ­¥éª¤" class="headerlink" title="æäº¤è´¡çŒ®æ­¥éª¤"></a>æäº¤è´¡çŒ®æ­¥éª¤</h3><ul>
<li><strong>Forké¡¹ç›®ä»“åº“</strong>ï¼šåœ¨GitHubä¸Šæ‰¾åˆ°ä½ æƒ³è¦è´¡çŒ®çš„é¡¹ç›®ï¼Œç‚¹å‡»é¡¹ç›®é¡µé¢ä¸Šçš„â€Forkâ€æŒ‰é’®</li>
<li><strong>å…‹éš†ä»“åº“åˆ°æœ¬åœ°</strong>ï¼šä½¿ç”¨git cloneå‘½ä»¤å°†ä½ Forkçš„é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°</li>
<li><strong>åˆ›å»ºæ–°åˆ†æ”¯</strong>ï¼šåœ¨æœ¬åœ°ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯è¿›è¡Œä½ çš„å·¥ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªè‰¯å¥½çš„å®è·µã€‚ä½¿ç”¨git checkout -b branch-nameåˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯</li>
<li><strong>æäº¤æ›´æ”¹</strong>ï¼šä½¿ç”¨git addå’Œgit commitå‘½ä»¤æäº¤ä½ çš„æ›´æ”¹</li>
<li><strong>æ¨é€æ›´æ”¹åˆ°GitHub</strong>ï¼šä½¿ç”¨git push origin branch-nameå°†æ›´æ”¹æ¨é€å›ä½ çš„GitHubä»“åº“</li>
<li><strong>åˆ›å»ºPull Request</strong>ï¼šåœ¨GitHubä¸Šï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªâ€Compare &amp; pull requestâ€æŒ‰é’®ã€‚ç‚¹å‡»å®ƒï¼Œå¡«å†™PRçš„æ ‡é¢˜å’Œæè¿°ï¼Œç„¶åæäº¤</li>
</ul>
<h2 id="todo-list"><a href="#todo-list" class="headerlink" title="todo list"></a>todo list</h2><ul>
<li>é»‘åå•é˜ˆå€¼, è¾¾åˆ°é˜ˆå€¼åç›´æ¥ä¸å“åº”å¹¶è¸¢å‡ºç¾¤èŠ</li>
<li>ç¾¤ç®¡ç†åˆ¶åº¦, ç»“åˆç¾¤ä¼—åŠ›é‡ç®¡ç†ç¤¾åŒºæ°›å›´</li>
<li>å®ç°å¼•ç”¨æ¶ˆæ¯ç›¸å…³çš„åŠŸèƒ½, å¦‚ä¸‹è½½å¼•ç”¨çš„å›¾ç‰‡</li>
<li>è¡¨æƒ…åŒ…ç”Ÿæˆæ’ä»¶</li>
</ul>
<blockquote>
<p>é¡¹ç›®å·²å¼€æºè‡³ <a target="_blank" rel="noopener" href="https://github.com/kanwuqing/LegendWechatBot">Github</a> ï¼Œæ¬¢è¿starå’Œfork<br>è‹¥ä½ è§‰å¾—å¯¹ä½ çš„å¼€å‘æœ‰å¸®åŠ©, æˆ–æ˜¯å¯¹ä½ çš„ç”Ÿæ´»æä¾›äº†æ–¹ä¾¿, æ¬¢è¿æ¥ <a target="_blank" rel="noopener" href="https://afdian.tv/a/kanwuqing">çˆ±å‘ç”µ</a> èµåŠ©<br><img src="/Week2%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/afdian-kanwuqing.jpg" alt="çˆ±å‘ç”µ"><br>å¦‚æœæƒ³ä¸€èµ·å¼€å‘æˆ–è´¡çŒ®æ’ä»¶ç­‰, æ¬¢è¿åœ¨ç›¸å…³æ ‡å‡†åˆ¶å®šåæŒ‰ç…§æ ‡å‡†æäº¤PR, æˆ– <a href="mailto:&#x6b;&#x61;&#110;&#119;&#x75;&#x71;&#105;&#x6e;&#103;&#64;&#49;&#54;&#x33;&#46;&#x63;&#111;&#x6d;">è”ç³»ä½œè€…</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kanwuqing.github.io/Week1%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Kanwuqing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanwuqing's Homepage">
      <meta itemprop="description" content="æ‰‹æŒ‘å°å‰‘èµ›å°ä»™, çŠ¹æŠ±è½»è½¯æ•´æ—¥é—²">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Kanwuqing's Homepage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Week1%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">LegendWechatBot é¡¹ç›®è¿›ç¨‹ Week1(2025-03-01 ~ 2025-03-09)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-09 10:00:00" itemprop="dateCreated datePublished" datetime="2025-03-09T10:00:00+08:00">2025-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-15 22:45:31" itemprop="dateModified" datetime="2025-03-15T22:45:31+08:00">2025-03-15</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>27 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="é¡¹ç›®çµæ„Ÿ"><a href="#é¡¹ç›®çµæ„Ÿ" class="headerlink" title="é¡¹ç›®çµæ„Ÿ"></a>é¡¹ç›®çµæ„Ÿ</h2><ul>
<li>æœ¬é¡¹ç›®æ·±å—å®˜æ–¹Qç¾¤æœºå™¨äººä»¥åŠå¾®ä¿¡æœºå™¨äººçš„å¯å‘, ä½†ä¸æ»¡è¶³äºç°æœ‰çš„åŠŸèƒ½, å› æ­¤å†³å®šè‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªå¾®ä¿¡æœºå™¨äºº, ä»¥å®ç°æ›´å¤šåŠŸèƒ½</li>
</ul>
<h2 id="é¡¹ç›®æ€»ç›®æ ‡"><a href="#é¡¹ç›®æ€»ç›®æ ‡" class="headerlink" title="é¡¹ç›®æ€»ç›®æ ‡"></a>é¡¹ç›®æ€»ç›®æ ‡</h2><h3 id="å®ç°ä¸€ä¸ªå¾®ä¿¡æœºå™¨äºº-èƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½"><a href="#å®ç°ä¸€ä¸ªå¾®ä¿¡æœºå™¨äºº-èƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½" class="headerlink" title="å®ç°ä¸€ä¸ªå¾®ä¿¡æœºå™¨äºº, èƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½:"></a>å®ç°ä¸€ä¸ªå¾®ä¿¡æœºå™¨äºº, èƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½:</h3><ul>
<li><p><strong>æ¥æ”¶å¹¶å¤„ç†</strong></p>
  <details>
      <summary>å±•å¼€æŸ¥çœ‹</summary>
      <ul>
          <li>æ–‡æœ¬æ¶ˆæ¯
          </li><li>ç³»ç»Ÿæ¶ˆæ¯
          <ul>
              <li>ç¾¤èŠæ–°æˆå‘˜åŠ å…¥æ¶ˆæ¯
              </li><li>å¥½å‹éªŒè¯æ¶ˆæ¯
              </li><li>çº¢åŒ…æ¶ˆæ¯
              </li><li>è½¬è´¦æ¶ˆæ¯
          </li></ul></li>
          <li>å›¾ç‰‡æ¶ˆæ¯
          </li><li>è¯­éŸ³æ¶ˆæ¯
          </li><li>è§†é¢‘æ¶ˆæ¯
          </li><li>æ–‡ä»¶æ¶ˆæ¯
          </li><li>ä½ç½®æ¶ˆæ¯
          </li><li>ç¾¤èŠatæ¶ˆæ¯
          </li><li>ç§èŠæ¶ˆæ¯
          </li><li>è¿ç¦æ¶ˆæ¯
      </li></ul>
  </details>
</li>
<li><p><strong>å‘é€</strong></p>
  <details>
      <summary>å±•å¼€æŸ¥çœ‹</summary>
      <ul>
          <li>æ–‡æœ¬æ¶ˆæ¯
          </li><li>å›¾ç‰‡æ¶ˆæ¯
          </li><li>è¯­éŸ³æ¶ˆæ¯
          </li><li>è§†é¢‘æ¶ˆæ¯
          </li><li>æ–‡ä»¶æ¶ˆæ¯
          </li><li>é“¾æ¥æ¶ˆæ¯
          </li><li>ç¾¤èŠatæ¶ˆæ¯
          </li><li>ç§èŠæ¶ˆæ¯
      </li></ul>
  </details>
</li>
<li><p><strong>ç³»ç»Ÿ</strong></p>
  <details>
      <summary>å±•å¼€æŸ¥çœ‹</summary>
      <ul>
          <li>ç¾¤ç®¡ç†ç³»ç»Ÿ
          </li><li>ç§¯åˆ†ç³»ç»Ÿ
          </li><li>è¿ç¦è¯ç®¡ç†ç³»ç»Ÿ
          </li><li>å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
          </li><li>æ’ä»¶ç³»ç»Ÿ
          </li><li>æ—¥å¿—ç³»ç»Ÿ
          </li><li>æ•°æ®ç»Ÿè®¡ç³»ç»Ÿ
          </li><li>é€Ÿç‡é™åˆ¶ç³»ç»Ÿ
          </li><li>çƒ­æ›´æ–°ç³»ç»Ÿ
          </li><li>GUIç³»ç»Ÿ
      </li></ul>
  </details></li>
</ul>
<h2 id="é¡¹ç›®åŸºç¡€"><a href="#é¡¹ç›®åŸºç¡€" class="headerlink" title="é¡¹ç›®åŸºç¡€"></a>é¡¹ç›®åŸºç¡€</h2><h3 id="ç¼–ç¨‹è¯­è¨€-Python-3-11-9"><a href="#ç¼–ç¨‹è¯­è¨€-Python-3-11-9" class="headerlink" title="ç¼–ç¨‹è¯­è¨€: Python 3.11.9"></a>ç¼–ç¨‹è¯­è¨€: Python 3.11.9</h3><h3 id="å¾®ä¿¡è°ƒç”¨æ¡†æ¶-WCFerry"><a href="#å¾®ä¿¡è°ƒç”¨æ¡†æ¶-WCFerry" class="headerlink" title="å¾®ä¿¡è°ƒç”¨æ¡†æ¶: WCFerry"></a>å¾®ä¿¡è°ƒç”¨æ¡†æ¶: <a target="_blank" rel="noopener" href="https://github.com/lich0821/WeChatFerry">WCFerry</a></h3><h3 id="æ•°æ®åº“-SQLite"><a href="#æ•°æ®åº“-SQLite" class="headerlink" title="æ•°æ®åº“: SQLite"></a>æ•°æ®åº“: <a target="_blank" rel="noopener" href="https://www.sqlite.org/index.html">SQLite</a></h3><h3 id="æ—¥å¿—é›†æˆ-loguru"><a href="#æ—¥å¿—é›†æˆ-loguru" class="headerlink" title="æ—¥å¿—é›†æˆ: loguru"></a>æ—¥å¿—é›†æˆ: <a target="_blank" rel="noopener" href="https://github.com/Delgan/loguru">loguru</a></h3><h3 id="å®šæ—¶ä»»åŠ¡æ¡†æ¶-APScheduler"><a href="#å®šæ—¶ä»»åŠ¡æ¡†æ¶-APScheduler" class="headerlink" title="å®šæ—¶ä»»åŠ¡æ¡†æ¶: APScheduler"></a>å®šæ—¶ä»»åŠ¡æ¡†æ¶: <a target="_blank" rel="noopener" href="https://github.com/agronholm/apscheduler">APScheduler</a></h3><h2 id="é¡¹ç›®å¼€å‘æ—¥å¿—-Week-1"><a href="#é¡¹ç›®å¼€å‘æ—¥å¿—-Week-1" class="headerlink" title="é¡¹ç›®å¼€å‘æ—¥å¿— (Week 1)"></a>é¡¹ç›®å¼€å‘æ—¥å¿— (Week 1)</h2><h3 id="é¡¹ç›®åˆå§‹åŒ–"><a href="#é¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="é¡¹ç›®åˆå§‹åŒ–"></a>é¡¹ç›®åˆå§‹åŒ–</h3><p>åˆšåˆšæœ‰çµæ„Ÿä¸ä¹…, æˆ‘ä¾¿ç¡®å®šäº†é¡¹ç›®çš„åŸºç¡€æ¡†æ¶, å”¯ç‹¬å¾®ä¿¡æ¡†æ¶æ‹¿æä¸å®š, çœ¼å‰æœ‰æ•°ä¸ªå¾®ä¿¡åè®®å¯ä¾›ä½¿ç”¨: </p>
<p>ç½‘é¡µç‰ˆåè®® (ä»¥ <a target="_blank" rel="noopener" href="https://github.com/littlecodersh/ItChat">itchat</a> ä¸ºä»£è¡¨)</p>
<p>iPadåè®® (ä»¥ <a target="_blank" rel="noopener" href="https://github.com/wechaty/wechaty">Wechaty</a> ä¸ºä»£è¡¨)</p>
<p>hook (ä»¥ <a target="_blank" rel="noopener" href="https://github.com/billyplus/ntchat">ntchat</a> å’Œ <a target="_blank" rel="noopener" href="https://github.com/lich0821/WeChatFerry">wcferry</a> ä¸ºä»£è¡¨)</p>
<p>ç»¼åˆåˆ†æä¹‹å, æˆ‘å‘ç°<em>itchat</em>ä»¥åŠå…¶æ‰€å±çš„ç½‘é¡µç‰ˆå¾®ä¿¡åè®®å·²ç»ä¸å†ç»´æŠ¤, è¾ƒæ™šæ³¨å†Œçš„å¾®ä¿¡è´¦å·ä¹Ÿæ— æ³•ç™»å½•ç½‘é¡µç‰ˆ; <em>Wechaty</em>åŠŸèƒ½å¾ˆå…¨, ä½†éœ€è¦è´­ä¹°Token, ä»…æœ‰åŸºç¡€åŠŸèƒ½æ˜¯å¼€æºçš„; <em>ntchat</em>ä¹Ÿæ—©åœ¨3å¹´å‰ä¹Ÿå·²ç»åœæ­¢ç»´æŠ¤, è¿™äº›ä¸ç¬¦åˆé¡¹ç›®éœ€æ±‚, å› æ­¤æˆ‘èµ·åˆé€‰æ‹©äº†è¿‘æœŸä»åœ¨æ›´æ–°çš„<em>wcferry</em>ä½œä¸ºæˆ‘çš„å¾®ä¿¡åè®®, å¹¶å‚ç…§å…¶demoè¿›è¡Œäº†ä»0çš„å¼€å‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">é¡¹ç›®ç»“æ„ (ä»¥åçš„æ—¥å¿—ä¸­ä»…è´´å‡ºåšä¿®æ”¹çš„ç»“æ„éƒ¨åˆ†)</span><br><span class="line">LegendWechatBot</span><br><span class="line">â”œâ”€ config  # æœºå™¨äººä¸»è®¾ç½®</span><br><span class="line">â”‚  â”œâ”€ config.py</span><br><span class="line">â”‚  â””â”€ config.yaml</span><br><span class="line">â”œâ”€ README.md</span><br><span class="line">â”œâ”€ main.py  # ä¸»å¯åŠ¨ç¨‹åº</span><br><span class="line">â”œâ”€ requirements.txt</span><br><span class="line">â”œâ”€ robot.py  # æœºå™¨äººæ ¸å¿ƒç¨‹åº</span><br><span class="line">â”œâ”€ try.py  # (éå¿…è¦) ç”¨æ¥ç¦»çº¿æµ‹è¯•</span><br><span class="line">â””â”€ utils</span><br><span class="line">   â”œâ”€ asyncEnsure.py  # æ¶ˆæ¯å‘é€é¢‘ç‡é™åˆ¶</span><br><span class="line">   â”œâ”€ changeHandler.py  # çƒ­æ›´æ–°</span><br><span class="line">   â”œâ”€ decorators.py  # æ’ä»¶å¤„ç†æ¶ˆæ¯ç±»å‹è£…é¥°å™¨</span><br><span class="line">   â”œâ”€ dfa.py  # æ•æ„Ÿè¯æ¨¡å—</span><br><span class="line">   â”œâ”€ eventManager.py  # äº‹ä»¶ç®¡ç†å™¨</span><br><span class="line">   â”œâ”€ LegendBot.py  # æœºå™¨äººæ ¸å¿ƒç±»</span><br><span class="line">   â”œâ”€ LegendMsg.py  # æ¶ˆæ¯å½’ä¸€åŒ–</span><br><span class="line">   â”œâ”€ logger.py  # æ—¥å¿—æ¨¡å—</span><br><span class="line">   â”œâ”€ plugin.py  # æ’ä»¶æ¨¡å—</span><br><span class="line">   â””â”€ singleton.py  # å•ä¾‹å½’ä¸€åŒ–</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="éš¾ç‚¹-æŠ€æœ¯çªç ´"><a href="#éš¾ç‚¹-æŠ€æœ¯çªç ´" class="headerlink" title="éš¾ç‚¹&amp;æŠ€æœ¯çªç ´"></a>éš¾ç‚¹&amp;æŠ€æœ¯çªç ´</h3><h4 id="1-çƒ­æ›´æ–°"><a href="#1-çƒ­æ›´æ–°" class="headerlink" title="1. çƒ­æ›´æ–°"></a>1. çƒ­æ›´æ–°</h4><p>ç”±äºæˆ‘éœ€è¦é¢‘ç¹åœ°ä¿®æ”¹æ’ä»¶, å› æ­¤æˆ‘éœ€è¦å®ç°çƒ­æ›´æ–°, ä»¥ä¾¿åœ¨ä¿®æ”¹æ’ä»¶åæ— éœ€é‡å¯æœºå™¨äººå³å¯ç”Ÿæ•ˆ</p>
<p>æ–‡ä»¶æ”¹å˜æ£€æµ‹ä½¿ç”¨äº† <a target="_blank" rel="noopener" href="https://github.com/gorakhargosh/watchdog">watchdog</a> åº“, åœ¨æ£€æµ‹åˆ°æ–‡ä»¶æ”¹å˜å, ä¼šè°ƒç”¨é‡å¯å›è°ƒå‡½æ•°, é‡å¯ç¨‹åº</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! utils/changeHandler.py</span></span><br><span class="line"><span class="keyword">from</span> watchdog.events <span class="keyword">import</span> FileSystemEventHandler, FileSystemEvent</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è£…æ£€æµ‹æ–‡ä»¶æ”¹å˜å¹¶åˆ¤æ–­æ˜¯å¦é‡å¯çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigChangeHandler</span>(<span class="title class_ inherited__">FileSystemEventHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, restartCallback = restartProgram</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;åˆå§‹åŒ–é…ç½®æ–‡ä»¶å˜åŒ–å¤„ç†å™¨</span></span><br><span class="line"><span class="string">        :param restartCallback: é‡å¯å›è°ƒå‡½æ•°, é»˜è®¤ä¸ºNone, å³ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.restartCallback = restartCallback</span><br><span class="line">        <span class="variable language_">self</span>.lastTriggered = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.cooldown = <span class="number">2</span>  <span class="comment"># å†·å´æ—¶é—´(ç§’)</span></span><br><span class="line">        <span class="comment"># å½“å‘ç”Ÿé”™è¯¯æ—¶æ‰ä¼šå¼€å§‹ç­‰å¾…</span></span><br><span class="line">        <span class="variable language_">self</span>.waiting = <span class="literal">False</span>  <span class="comment"># æ˜¯å¦åœ¨ç­‰å¾…æ–‡ä»¶æ”¹å˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onModified</span>(<span class="params">self, event: FileSystemEvent</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.is_directory:</span><br><span class="line">            <span class="comment"># åˆ¤æ–­æ˜¯å¦åœ¨å†·å´æ—¶é—´å†…(é˜²æ­¢æŠ½é£)</span></span><br><span class="line">            currentTime = time.time()</span><br><span class="line">            <span class="keyword">if</span> currentTime - <span class="variable language_">self</span>.last_triggered &lt; <span class="variable language_">self</span>.cooldown:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            filePath = Path(event.src_path).resolve()</span><br><span class="line">            <span class="keyword">if</span> (filePath.name == <span class="string">&quot;config.yaml&quot;</span> <span class="keyword">or</span></span><br><span class="line">                    <span class="string">&quot;plugins&quot;</span> <span class="keyword">in</span> <span class="built_in">str</span>(filePath) <span class="keyword">and</span> filePath.suffix <span class="keyword">in</span> [<span class="string">&#x27;.py&#x27;</span>, <span class="string">&#x27;.yaml&#x27;</span>]):</span><br><span class="line">                logger.info(<span class="string">f&quot;æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–: <span class="subst">&#123;filePath&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.last_triggered = currentTime</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.waiting:</span><br><span class="line">                    logger.info(<span class="string">&quot;æ£€æµ‹åˆ°æ–‡ä»¶æ”¹å˜ï¼Œæ­£åœ¨é‡å¯...&quot;</span>)</span><br><span class="line">                    <span class="variable language_">self</span>.waiting = <span class="literal">False</span></span><br><span class="line">                <span class="variable language_">self</span>.restartCallback()</span><br></pre></td></tr></table></figure>

<p>é‡å¯ç¨‹åºæ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">restartProgram</span>(<span class="params">observer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é‡å¯ç¨‹åº, åˆ«å¤„ä¹Ÿå¯è°ƒç”¨&quot;&quot;&quot;</span></span><br><span class="line">    logger.info(<span class="string">&quot;æ­£åœ¨é‡å¯ç¨‹åº...&quot;</span>)</span><br><span class="line">    <span class="comment"># æ¸…ç†èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span> observer:  <span class="comment"># observeræ˜¯watchdogä¸­çš„å¯¹è±¡</span></span><br><span class="line">        observer.stop()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> multiprocessing.resource_tracker</span><br><span class="line">        multiprocessing.resource_tracker._resource_tracker.clear()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.warning(<span class="string">f&quot;æ¸…ç†èµ„æºæ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># é‡å¯ç¨‹åº</span></span><br><span class="line">    os.execv(sys.executable, [sys.executable] + sys.argv)</span><br></pre></td></tr></table></figure>



<h4 id="2-æ’ä»¶ç®¡ç†"><a href="#2-æ’ä»¶ç®¡ç†" class="headerlink" title="2. æ’ä»¶ç®¡ç†"></a>2. æ’ä»¶ç®¡ç†</h4><p>ç”±äºæœºå™¨äººé¡¹ç›®ä¸­å‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯æ’ä»¶åŒ–å®ç°çš„, å› æ­¤æˆ‘éœ€è¦å…ˆå®ç°æ’ä»¶ç®¡ç†åŠŸèƒ½</p>
<p>æ’ä»¶ç®¡ç†åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªåŠŸèƒ½æ¨¡å—:</p>
<ul>
<li>æ’ä»¶åŸºç±» &amp; æ’ä»¶å¯ç”¨&#x2F;ç¦ç”¨æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! utils/plugin.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PluginBase</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ’ä»¶åŸºç±»&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ’ä»¶å…ƒæ•°æ®</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="string">&quot;æš‚æ— æè¿°&quot;</span></span><br><span class="line">    author: <span class="built_in">str</span> = <span class="string">&quot;æœªçŸ¥&quot;</span></span><br><span class="line">    version: <span class="built_in">str</span> = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>._scheduled_jobs = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">on_enable</span>(<span class="params">self, bot=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ’ä»¶å¯ç”¨æ—¶è°ƒç”¨&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> method_name <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="variable language_">self</span>):</span><br><span class="line">            method = <span class="built_in">getattr</span>(<span class="variable language_">self</span>, method_name)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(method, <span class="string">&#x27;_is_scheduled&#x27;</span>):</span><br><span class="line">                job_id = <span class="built_in">getattr</span>(method, <span class="string">&#x27;_job_id&#x27;</span>)</span><br><span class="line">                trigger = <span class="built_in">getattr</span>(method, <span class="string">&#x27;_schedule_trigger&#x27;</span>)</span><br><span class="line">                trigger_args = <span class="built_in">getattr</span>(method, <span class="string">&#x27;_schedule_args&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                add_job_safe(scheduler, job_id, method, bot, trigger, **trigger_args)</span><br><span class="line">                <span class="variable language_">self</span>._scheduled_jobs.add(job_id)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._scheduled_jobs:</span><br><span class="line">            logger.success(<span class="string">f&quot;æ’ä»¶ <span class="subst">&#123;self.__class__.__name__&#125;</span> å·²åŠ è½½å®šæ—¶ä»»åŠ¡: <span class="subst">&#123;self._scheduled_jobs&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">on_disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ’ä»¶ç¦ç”¨æ—¶è°ƒç”¨&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç§»é™¤å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> job_id <span class="keyword">in</span> <span class="variable language_">self</span>._scheduled_jobs:</span><br><span class="line">            remove_job_safe(scheduler, job_id)</span><br><span class="line">        logger.info(<span class="string">&quot;å·²å¸è½½å®šæ—¶ä»»åŠ¡: &#123;&#125;&quot;</span>, <span class="variable language_">self</span>._scheduled_jobs)</span><br><span class="line">        <span class="variable language_">self</span>._scheduled_jobs.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_init</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ’ä»¶å¼‚æ­¥åˆå§‹åŒ–&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ’ä»¶(æ‰¹é‡)åŠ è½½&#x2F;å¸è½½&#x2F;é‡è½½</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PluginManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.plugins: <span class="type">Dict</span>[<span class="built_in">str</span>, PluginBase] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.plugin_classes: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Type</span>[PluginBase]] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.plugin_info: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">dict</span>] = &#123;&#125;  <span class="comment"># æ–°å¢ï¼šå­˜å‚¨æ‰€æœ‰æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.excluded_plugins = config.RobotConfig[<span class="string">&quot;disabledPlugins&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">load_plugin</span>(<span class="params">self, bot: WechatAPIClient, plugin_class: <span class="type">Type</span>[PluginBase], is_disabled: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŠ è½½å•ä¸ªæ’ä»¶, æ¥å—Type[PluginBase]&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            plugin_name = plugin_class.__name__</span><br><span class="line"></span><br><span class="line">            <span class="comment"># é˜²æ­¢é‡å¤åŠ è½½æ’ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> plugin_name <span class="keyword">in</span> <span class="variable language_">self</span>.plugins:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># è®°å½•æ’ä»¶ä¿¡æ¯ï¼Œå³ä½¿æ’ä»¶è¢«ç¦ç”¨ä¹Ÿä¼šè®°å½•</span></span><br><span class="line">            <span class="variable language_">self</span>.plugin_info[plugin_name] = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: plugin_name,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: plugin_class.description,</span><br><span class="line">                <span class="string">&quot;author&quot;</span>: plugin_class.author,</span><br><span class="line">                <span class="string">&quot;version&quot;</span>: plugin_class.version,</span><br><span class="line">                <span class="string">&quot;enabled&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;class&quot;</span>: plugin_class</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¦‚æœæ’ä»¶è¢«ç¦ç”¨åˆ™ä¸åŠ è½½</span></span><br><span class="line">            <span class="keyword">if</span> is_disabled:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            plugin = plugin_class()</span><br><span class="line">            EventManager.bind_instance(plugin)</span><br><span class="line">            <span class="keyword">await</span> plugin.on_enable(bot)</span><br><span class="line">            <span class="keyword">await</span> plugin.async_init()</span><br><span class="line">            <span class="variable language_">self</span>.plugins[plugin_name] = plugin</span><br><span class="line">            <span class="variable language_">self</span>.plugin_classes[plugin_name] = plugin_class</span><br><span class="line">            <span class="variable language_">self</span>.plugin_info[plugin_name][<span class="string">&quot;enabled&quot;</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            logger.error(<span class="string">f&quot;åŠ è½½æ’ä»¶æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">unload_plugin</span>(<span class="params">self, plugin_name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¸è½½å•ä¸ªæ’ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> plugin_name <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.plugins:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é˜²æ­¢å¸è½½ ManagePlugin</span></span><br><span class="line">        <span class="keyword">if</span> plugin_name == <span class="string">&quot;ManagePlugin&quot;</span>:</span><br><span class="line">            logger.warning(<span class="string">&quot;ManagePlugin ä¸èƒ½è¢«å¸è½½&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            plugin = <span class="variable language_">self</span>.plugins[plugin_name]</span><br><span class="line">            <span class="keyword">await</span> plugin.on_disable()</span><br><span class="line">            EventManager.unbind_instance(plugin)</span><br><span class="line">            <span class="keyword">del</span> <span class="variable language_">self</span>.plugins[plugin_name]</span><br><span class="line">            <span class="keyword">del</span> <span class="variable language_">self</span>.plugin_classes[plugin_name]</span><br><span class="line">            <span class="keyword">if</span> plugin_name <span class="keyword">in</span> <span class="variable language_">self</span>.plugin_info.keys():</span><br><span class="line">                <span class="variable language_">self</span>.plugin_info[plugin_name][<span class="string">&quot;enabled&quot;</span>] = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            logger.error(<span class="string">f&quot;å¸è½½æ’ä»¶ <span class="subst">&#123;plugin_name&#125;</span> æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">unload_all_plugins</span>(<span class="params">self</span>) -&gt; <span class="built_in">tuple</span>[<span class="type">List</span>[<span class="built_in">str</span>], <span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¸è½½æ‰€æœ‰æ’ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        unloaded_plugins = []</span><br><span class="line">        failed_unloads = []</span><br><span class="line">        <span class="keyword">for</span> plugin_name <span class="keyword">in</span> <span class="built_in">list</span>(<span class="variable language_">self</span>.plugins.keys()):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">await</span> <span class="variable language_">self</span>.unload_plugin(plugin_name):</span><br><span class="line">                unloaded_plugins.append(plugin_name)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                failed_unloads.append(plugin_name)</span><br><span class="line">        <span class="keyword">return</span> unloaded_plugins, failed_unloads</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">reload_plugin</span>(<span class="params">self, bot: WechatAPIClient, plugin_name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é‡è½½å•ä¸ªæ’ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> plugin_name <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.plugin_classes:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é˜²æ­¢é‡è½½ ManagePlugin</span></span><br><span class="line">        <span class="keyword">if</span> plugin_name == <span class="string">&quot;ManagePlugin&quot;</span>:</span><br><span class="line">            logger.warning(<span class="string">&quot;ManagePlugin ä¸èƒ½è¢«é‡è½½&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è·å–æ’ä»¶ç±»æ‰€åœ¨çš„æ¨¡å—</span></span><br><span class="line">            plugin_class = <span class="variable language_">self</span>.plugin_classes[plugin_name]</span><br><span class="line">            module_name = plugin_class.__module__</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å…ˆå¸è½½æ’ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">await</span> <span class="variable language_">self</span>.unload_plugin(plugin_name):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span></span><br><span class="line">            module = importlib.import_module(module_name)</span><br><span class="line">            importlib.reload(module)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä»é‡æ–°åŠ è½½çš„æ¨¡å—ä¸­è·å–æ’ä»¶ç±»</span></span><br><span class="line">            <span class="keyword">for</span> name, obj <span class="keyword">in</span> inspect.getmembers(module):</span><br><span class="line">                <span class="keyword">if</span> (inspect.isclass(obj) <span class="keyword">and</span></span><br><span class="line">                        <span class="built_in">issubclass</span>(obj, PluginBase) <span class="keyword">and</span></span><br><span class="line">                        obj != PluginBase <span class="keyword">and</span></span><br><span class="line">                        obj.__name__ == plugin_name):</span><br><span class="line">                    <span class="comment"># ä½¿ç”¨æ–°çš„æ’ä»¶ç±»è€Œä¸æ˜¯æ—§çš„</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">self</span>.load_plugin(bot, obj)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;é‡è½½æ’ä»¶ <span class="subst">&#123;plugin_name&#125;</span> æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">reload_all_plugins</span>(<span class="params">self, bot: WechatAPIClient</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é‡è½½æ‰€æœ‰æ’ä»¶</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List[str]: æˆåŠŸé‡è½½çš„æ’ä»¶åç§°åˆ—è¡¨</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è®°å½•å½“å‰åŠ è½½çš„æ’ä»¶åç§°ï¼Œæ’é™¤ ManagePlugin</span></span><br><span class="line">            original_plugins = [name <span class="keyword">for</span> name <span class="keyword">in</span> <span class="variable language_">self</span>.plugins.keys() <span class="keyword">if</span> name != <span class="string">&quot;ManagePlugin&quot;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¸è½½é™¤ ManagePlugin å¤–çš„æ‰€æœ‰æ’ä»¶</span></span><br><span class="line">            <span class="keyword">for</span> plugin_name <span class="keyword">in</span> original_plugins:</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.unload_plugin(plugin_name)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># é‡æ–°åŠ è½½æ‰€æœ‰æ¨¡å—</span></span><br><span class="line">            <span class="keyword">for</span> module_name <span class="keyword">in</span> <span class="built_in">list</span>(sys.modules.keys()):</span><br><span class="line">                <span class="keyword">if</span> module_name.startswith(<span class="string">&#x27;plugins.&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> module_name.endswith(<span class="string">&#x27;ManagePlugin&#x27;</span>):</span><br><span class="line">                    <span class="keyword">del</span> sys.modules[module_name]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä»ç›®å½•é‡æ–°åŠ è½½æ’ä»¶</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">self</span>.load_plugins_from_directory(bot)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            logger.error(<span class="string">f&quot;é‡è½½æ‰€æœ‰æ’ä»¶æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»æ–‡ä»¶å¤¹ä¸­åŠ è½½æ’ä»¶</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">load_plugins_from_directory</span>(<span class="params">self, bot: WechatAPIClient, load_disabled_plugin: <span class="built_in">bool</span> = <span class="literal">True</span></span>) -&gt; <span class="type">Union</span>[<span class="type">List</span>[<span class="built_in">str</span>], <span class="built_in">bool</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»pluginsç›®å½•æ‰¹é‡åŠ è½½æ’ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    loaded_plugins = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> dirname <span class="keyword">in</span> os.listdir(<span class="string">&quot;plugins&quot;</span>):</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(<span class="string">f&quot;plugins/<span class="subst">&#123;dirname&#125;</span>&quot;</span>) <span class="keyword">and</span> os.path.exists(<span class="string">f&quot;plugins/<span class="subst">&#123;dirname&#125;</span>/main.py&quot;</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                module = importlib.import_module(<span class="string">f&quot;plugins.<span class="subst">&#123;dirname&#125;</span>.main&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> name, obj <span class="keyword">in</span> inspect.getmembers(module):</span><br><span class="line">                    <span class="keyword">if</span> inspect.isclass(obj) <span class="keyword">and</span> <span class="built_in">issubclass</span>(obj, PluginBase) <span class="keyword">and</span> obj != PluginBase:</span><br><span class="line">                        is_disabled = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> load_disabled_plugin:</span><br><span class="line">                            is_disabled = obj.__name__ <span class="keyword">in</span> <span class="variable language_">self</span>.excluded_plugins</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">await</span> <span class="variable language_">self</span>.load_plugin(bot, obj, is_disabled=is_disabled):</span><br><span class="line">                            loaded_plugins.append(obj.__name__)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                logger.error(<span class="string">f&quot;åŠ è½½ <span class="subst">&#123;dirname&#125;</span> æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loaded_plugins</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">load_plugin_from_directory</span>(<span class="params">self, bot: WechatAPIClient, plugin_name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»pluginsç›®å½•åŠ è½½å•ä¸ªæ’ä»¶</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        bot: æœºå™¨äººå®ä¾‹</span></span><br><span class="line"><span class="string">        plugin_name: æ’ä»¶ç±»åç§°ï¼ˆä¸æ˜¯æ–‡ä»¶åï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        bool: æ˜¯å¦æˆåŠŸåŠ è½½æ’ä»¶</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> dirname <span class="keyword">in</span> os.listdir(<span class="string">&quot;plugins&quot;</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> os.path.isdir(<span class="string">f&quot;plugins/<span class="subst">&#123;dirname&#125;</span>&quot;</span>) <span class="keyword">and</span> os.path.exists(<span class="string">f&quot;plugins/<span class="subst">&#123;dirname&#125;</span>/main.py&quot;</span>):</span><br><span class="line">                module = importlib.import_module(<span class="string">f&quot;plugins.<span class="subst">&#123;dirname&#125;</span>.main&quot;</span>)</span><br><span class="line">                importlib.reload(module)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> name, obj <span class="keyword">in</span> inspect.getmembers(module):</span><br><span class="line">                    <span class="keyword">if</span> (inspect.isclass(obj) <span class="keyword">and</span></span><br><span class="line">                            <span class="built_in">issubclass</span>(obj, PluginBase) <span class="keyword">and</span></span><br><span class="line">                            obj != PluginBase <span class="keyword">and</span></span><br><span class="line">                            obj.__name__ == plugin_name):</span><br><span class="line">                        found = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">self</span>.load_plugin(bot, obj)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            logger.error(<span class="string">f&quot;æ£€æŸ¥ <span class="subst">&#123;dirname&#125;</span> æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">        logger.warning(<span class="string">f&quot;æœªæ‰¾åˆ°æ’ä»¶ç±» <span class="subst">&#123;plugin_name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ’ä»¶ä¿¡æ¯è·å–</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_plugin_info</span>(<span class="params">self, plugin_name: <span class="built_in">str</span> = <span class="literal">None</span></span>) -&gt; <span class="type">Union</span>[<span class="built_in">dict</span>, <span class="type">List</span>[<span class="built_in">dict</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        plugin_name: æ’ä»¶åç§°, å¦‚æœä¸ºNoneåˆ™è¿”å›æ‰€æœ‰æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        å¦‚æœæŒ‡å®šæ’ä»¶åï¼Œè¿”å›å•ä¸ªæ’ä»¶ä¿¡æ¯å­—å…¸ï¼›å¦åˆ™è¿”å›æ‰€æœ‰æ’ä»¶ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> plugin_name:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.plugin_info.get(plugin_name)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="variable language_">self</span>.plugin_info.values())</span><br></pre></td></tr></table></figure>

<ul>
<li>(todo) æ’ä»¶ä¾èµ–è·å–</li>
<li>(todo) æ’ä»¶è®¾ç½®GUI</li>
</ul>
<h4 id="3-å®šæ—¶ä»»åŠ¡"><a href="#3-å®šæ—¶ä»»åŠ¡" class="headerlink" title="3. å®šæ—¶ä»»åŠ¡"></a>3. å®šæ—¶ä»»åŠ¡</h4><p>åœ¨å¾®ä¿¡æœºå™¨äººä¸­, æœ‰å¾ˆå¤šä»»åŠ¡éƒ½éœ€è¦å®šæ—¶æ‰§è¡Œ, æ¯”å¦‚æ¯å¤©å®šæ—¶å‘é€æŠ¥çº¸, æ¸…ç©ºç”¨æˆ·ç­¾åˆ°çŠ¶æ€ç­‰<br>å› æ­¤éœ€è¦å°è£…ä¸€ä¸ªç±»è®©æ’ä»¶æ–¹ä¾¿åœ°è§„å®šå®šæ—¶ä»»åŠ¡, åœ¨æ­¤é¡¹ç›®ä¸­, æˆ‘é€‰æ‹©äº†<em>APScheduler</em><br>å’Œè£…é¥°å™¨æ¥å®ç°</p>
<blockquote>
<p>APScheduleræœ‰ä¸€ä¸ªç‰¹è‰²è¡¨è¾¾å¼: Cron, å…·ä½“è¯­æ³•å’Œç”¨æ³•è¯·å‚é˜… <a target="_blank" rel="noopener" href="https://www.cjavapy.com/article/128/">cronè¡¨è¾¾å¼</a></p>
</blockquote>
<ul>
<li>å®šæ—¶ä»»åŠ¡å¢åˆ </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_job_safe</span>(<span class="params">scheduler: AsyncIOScheduler, job_id: <span class="built_in">str</span>, func: <span class="type">Callable</span>, bot, trigger: <span class="type">Union</span>[<span class="built_in">str</span>, CronTrigger, IntervalTrigger], **trigger_args</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ·»åŠ å‡½æ•°åˆ°å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™å…ˆåˆ é™¤ç°æœ‰çš„ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        scheduler.remove_job(job_id)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    scheduler.add_job(func, trigger, args=[bot], <span class="built_in">id</span>=job_id, **trigger_args)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_job_safe</span>(<span class="params">scheduler: AsyncIOScheduler, job_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»å®šæ—¶ä»»åŠ¡ä¸­ç§»é™¤ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        scheduler.remove_job(job_id)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®šæ—¶ä»»åŠ¡è£…é¥°å™¨</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AsyncIOScheduler</span><br><span class="line"><span class="keyword">from</span> apscheduler.triggers.cron <span class="keyword">import</span> CronTrigger</span><br><span class="line"><span class="keyword">from</span> apscheduler.triggers.interval <span class="keyword">import</span> IntervalTrigger</span><br><span class="line"></span><br><span class="line">scheduler = AsyncIOScheduler()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">schedule</span>(<span class="params">trigger: <span class="type">Union</span>[<span class="built_in">str</span>, CronTrigger, IntervalTrigger], **trigger_args</span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å®šæ—¶ä»»åŠ¡è£…é¥°å™¨</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ä¾‹å­:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - @schedule(&#x27;interval&#x27;, seconds=30)</span></span><br><span class="line"><span class="string">    - @schedule(&#x27;cron&#x27;, hour=8, minute=30, second=30)</span></span><br><span class="line"><span class="string">    - @schedule(&#x27;date&#x27;, run_date=&#x27;2024-01-01 00:00:00&#x27;)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func: <span class="type">Callable</span></span>):</span><br><span class="line">        job_id = <span class="string">f&quot;<span class="subst">&#123;func.__module__&#125;</span>.<span class="subst">&#123;func.__qualname__&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> func(<span class="variable language_">self</span>, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_is_scheduled&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_schedule_trigger&#x27;</span>, trigger)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_schedule_args&#x27;</span>, trigger_args)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_job_id&#x27;</span>, job_id)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure>


<h4 id="4-äº‹ä»¶æ˜ å°„"><a href="#4-äº‹ä»¶æ˜ å°„" class="headerlink" title="4. äº‹ä»¶æ˜ å°„"></a>4. äº‹ä»¶æ˜ å°„</h4><p>åœ¨æ’ä»¶åŒ–ç¨‹åºä¸­, äº‹ä»¶å¤„ç†æ˜¯æ ¸å¿ƒéƒ¨åˆ†, éœ€è¦å®šä¹‰ä¸€ä¸ªç±»æ¥ç®¡ç†äº‹ä»¶, å¹¶å°†äº‹ä»¶æ˜ å°„åˆ°æ’ä»¶ä¸­</p>
<ul>
<li>æ¶ˆæ¯å¤„ç†è£…é¥°å™¨<blockquote>
<p>è£…é¥°å™¨å¯ä»¥ç”¨æ¥ç»™å‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½, åœ¨LegendWeChatBotä¸­, ä½¿ç”¨è£…é¥°å™¨æ¥è§„èŒƒå¹¶ç®€åŒ–æ’ä»¶å¤„ç†æ¶ˆæ¯çš„é€»è¾‘</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>åœ¨è£…é¥°å™¨ä¸­æ·»åŠ äº†ä¼˜å…ˆçº§å’Œæ—¶é—´ç±»å‹, ç”¨æ¥å¯¹ä¸åŒç±»å‹çš„äº‹ä»¶è¿›è¡Œæ’åºå’Œç­›é€‰</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! utils/decorators.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">priority=<span class="number">50</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¶ˆæ¯è£…é¥°å™¨, å…·ä½“æ¶ˆæ¯å‚è§å…·ä½“æ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">callable</span>(priority):</span><br><span class="line">            f = priority</span><br><span class="line">            <span class="built_in">setattr</span>(f, <span class="string">&#x27;_event_type&#x27;</span>, <span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">            <span class="built_in">setattr</span>(f, <span class="string">&#x27;_priority&#x27;</span>, <span class="number">50</span>)</span><br><span class="line">            <span class="keyword">return</span> f</span><br><span class="line">        <span class="built_in">setattr</span>(func, <span class="string">&#x27;_event_type&#x27;</span>, <span class="string">&#x27;other_message&#x27;</span>)</span><br><span class="line">        <span class="built_in">setattr</span>(func, <span class="string">&#x27;_priority&#x27;</span>, <span class="built_in">min</span>(<span class="built_in">max</span>(priority, <span class="number">0</span>), <span class="number">99</span>))</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(priority) <span class="keyword">else</span> decorator(priority)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;demo&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@on_message</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">demo</span>(<span class="params">bot, message</span>):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li>äº‹ä»¶æ˜ å°„ç®¡ç†<blockquote>
<p>ç¼ºå¯¹è±¡å—? æ¥Pythonè¿™å„¿æ‰¾ä¸€ä¸ª</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! utils/eventManager.py</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventManager</span>:</span><br><span class="line">    _handlers: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">tuple</span>[<span class="type">Callable</span>, <span class="built_in">object</span>, <span class="built_in">int</span>]]] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bind_instance</span>(<span class="params">cls, instance: <span class="built_in">object</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å°†å®ä¾‹ç»‘å®šåˆ°å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> method_name <span class="keyword">in</span> <span class="built_in">dir</span>(instance):</span><br><span class="line">            method = <span class="built_in">getattr</span>(instance, method_name)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(method, <span class="string">&#x27;_event_type&#x27;</span>):</span><br><span class="line">                event_type = <span class="built_in">getattr</span>(method, <span class="string">&#x27;_event_type&#x27;</span>)</span><br><span class="line">                priority = <span class="built_in">getattr</span>(method, <span class="string">&#x27;_priority&#x27;</span>, <span class="number">50</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> event_type <span class="keyword">not</span> <span class="keyword">in</span> cls._handlers:</span><br><span class="line">                    cls._handlers[event_type] = []</span><br><span class="line">                cls._handlers[event_type].append((method, instance, priority))</span><br><span class="line">                <span class="comment"># æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œä¼˜å…ˆçº§é«˜çš„åœ¨å‰</span></span><br><span class="line">                cls._handlers[event_type].sort(key=<span class="keyword">lambda</span> x: x[<span class="number">2</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">emit</span>(<span class="params">cls, event_type: <span class="built_in">str</span>, *args, **kwargs</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è§¦å‘äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> event_type <span class="keyword">not</span> <span class="keyword">in</span> cls._handlers:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        api_client, message = args</span><br><span class="line">        <span class="keyword">for</span> handler, instance, priority <span class="keyword">in</span> cls._handlers[event_type]:</span><br><span class="line">            <span class="comment"># åªå¯¹ message è¿›è¡Œæ·±æ‹·è´ï¼Œapi_client ä¿æŒä¸å˜</span></span><br><span class="line">            handler_args = (api_client, copy.deepcopy(message))</span><br><span class="line">            new_kwargs = &#123;k: copy.deepcopy(v) <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items()&#125;</span><br><span class="line"></span><br><span class="line">            result = <span class="keyword">await</span> handler(*handler_args, **new_kwargs)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">bool</span>):</span><br><span class="line">                <span class="comment"># True ç»§ç»­æ‰§è¡Œ False åœæ­¢æ‰§è¡Œ</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span>  <span class="comment"># æˆ‘ä¹Ÿä¸çŸ¥é“ä½ è¿”å›äº†ä¸ªå•¥ç©æ„ï¼Œåæ­£ç»§ç»­æ‰§è¡Œå°±æ˜¯äº†</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unbind_instance</span>(<span class="params">cls, instance: <span class="built_in">object</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è§£ç»‘å®ä¾‹çš„æ‰€æœ‰äº‹ä»¶å¤„ç†å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> event_type <span class="keyword">in</span> cls._handlers:</span><br><span class="line">            cls._handlers[event_type] = [</span><br><span class="line">                (handler, inst, priority)</span><br><span class="line">                <span class="keyword">for</span> handler, inst, priority <span class="keyword">in</span> cls._handlers[event_type]</span><br><span class="line">                <span class="keyword">if</span> inst <span class="keyword">is</span> <span class="keyword">not</span> instance</span><br><span class="line">            ]</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šæ—¶ä»»åŠ¡ç®¡ç†<blockquote>
<p>å®šæ—¶ä»»åŠ¡ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†æ’ä»¶ä¸­éœ€è¦å®ç°çš„å®šæ—¶ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤ã€æ‰§è¡Œä»»åŠ¡ç­‰æ“ä½œ</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! utils/decorators.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">schedule</span>(<span class="params">trigger: <span class="type">Union</span>[<span class="built_in">str</span>, CronTrigger, IntervalTrigger],        **trigger_args</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å®šæ—¶ä»»åŠ¡è£…é¥°å™¨</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ä¾‹å­:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - @schedule(&#x27;interval&#x27;, seconds=30)</span></span><br><span class="line"><span class="string">    - @schedule(&#x27;cron&#x27;, hour=8, minute=30, second=30)</span></span><br><span class="line"><span class="string">    - @schedule(&#x27;date&#x27;, run_date=&#x27;2024-01-01 00:00:00&#x27;)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func: <span class="type">Callable</span></span>):</span><br><span class="line">        job_id = <span class="string">f&quot;<span class="subst">&#123;func.__module__&#125;</span>.<span class="subst">&#123;func.__qualname__&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> func(<span class="variable language_">self</span>, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_is_scheduled&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_schedule_trigger&#x27;</span>, trigger)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_schedule_args&#x27;</span>, trigger_args)</span><br><span class="line">        <span class="built_in">setattr</span>(wrapper, <span class="string">&#x27;_job_id&#x27;</span>, job_id)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_job_safe</span>(<span class="params">scheduler: AsyncIOScheduler, job_id: <span class="built_in">str</span>, func: <span class="type">Callable</span>, bot, trigger: <span class="type">Union</span>[<span class="built_in">str</span>, CronTrigger, intervalTrigger], **trigger_args</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ·»åŠ å‡½æ•°åˆ°å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™å…ˆåˆ é™¤ç°æœ‰çš„ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        scheduler.remove_job(job_id)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    scheduler.add_job(func, trigger, args=[bot], <span class="built_in">id</span>=job_id, **trigger_args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_job_safe</span>(<span class="params">scheduler: AsyncIOScheduler, job_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»å®šæ—¶ä»»åŠ¡ä¸­ç§»é™¤ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        scheduler.remove_job(job_id)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="todo-list"><a href="#todo-list" class="headerlink" title="todo list"></a>todo list</h3><ul>
<li>æ•´ç†å¾®ä¿¡æ•°æ®åº“æ“ä½œæ¨¡å—</li>
<li>åˆæ­¥æ·»åŠ åŠŸèƒ½</li>
<li>åˆæ­¥åˆ¶å®šå‘½ä»¤æ ¼å¼</li>
<li>å®Œå–„å¼€å‘å’Œä½¿ç”¨æ–‡æ¡£</li>
</ul>
<blockquote>
<p>é¡¹ç›®å·²å¼€æºè‡³ <a target="_blank" rel="noopener" href="https://github.com/kanwuqing/LegendWechatBot">Github</a> ï¼Œæ¬¢è¿starå’Œfork<br>è‹¥ä½ è§‰å¾—å¯¹ä½ çš„å¼€å‘æœ‰å¸®åŠ©, æˆ–æ˜¯å¯¹ä½ çš„ç”Ÿæ´»æä¾›äº†æ–¹ä¾¿, æ¬¢è¿æ¥ <a target="_blank" rel="noopener" href="https://afdian.tv/a/kanwuqing">çˆ±å‘ç”µ</a> èµåŠ©<br><img src="/Week1%E9%A1%B9%E7%9B%AE%E8%BF%9B%E7%A8%8B/afdian-kanwuqing.jpg" alt="çˆ±å‘ç”µ"><br>å¦‚æœæƒ³ä¸€èµ·å¼€å‘æˆ–è´¡çŒ®æ’ä»¶ç­‰, æ¬¢è¿åœ¨ç›¸å…³æ ‡å‡†åˆ¶å®šåæŒ‰ç…§æ ‡å‡†æäº¤PR, æˆ– <a href="mailto:&#x6b;&#x61;&#x6e;&#119;&#x75;&#113;&#105;&#x6e;&#103;&#64;&#x31;&#54;&#51;&#46;&#99;&#x6f;&#109;">è”ç³»ä½œè€…</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Kanwuqing</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">NaNm</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">NaN:aN</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>
-->

<!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® -->
<span id="timeDate">è½½å…¥å¤©æ•°...</span>
<span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© ";
        document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’.";
    }
setInterval("createtime()",250);
</script>
    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
